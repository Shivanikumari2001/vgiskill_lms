import{d as Q,y as P,bb as W,br as re,bs as _e,B as F,bt as ee,bh as U,bc as X,ba as I,z as ne,b6 as ie,bm as be,bd as B,bg as ke,bi as te,i as A,s as ve,v as ae,aN as he,ac as ye,c as M,J as K,h as b,o as d,w as v,e as k,f as x,a as T,b as y,u as l,Q as Ce,aY as xe,bE as De,p as H,l as z,t as $,c6 as ue,bF as Se,bD as we,D as Ee,aa as S,ab as Pe,aA as $e,q as Ne,aV as Oe,r as Ve,n as L,au as Me,_ as se,cD as Ie,bU as j,ao as le,cE as Be,cF as Le,bX as Te,ad as Re,F as ze}from"./index-C4szjxrb.js";import{D as oe}from"./vuedraggable.umd-DFZ6PtG-.js";import{s as Fe}from"./use-resolve-button-type-WYY12HT4.js";var Ue=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ue||{});let ce=Symbol("DisclosureContext");function J(e){let f=A(ce,null);if(f===null){let h=new Error(`<${e} /> is missing a parent <Disclosure /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(h,J),h}return f}let de=Symbol("DisclosurePanelContext");function Ae(){return A(de,null)}let qe=Q({name:"Disclosure",props:{as:{type:[Object,String],default:"template"},defaultOpen:{type:[Boolean],default:!1}},setup(e,{slots:f,attrs:h}){let g=P(e.defaultOpen?0:1),s=P(null),_=P(null),a={buttonId:P(`headlessui-disclosure-button-${W()}`),panelId:P(`headlessui-disclosure-panel-${W()}`),disclosureState:g,panel:s,button:_,toggleDisclosure(){g.value=ee(g.value,{0:1,1:0})},closeDisclosure(){g.value!==1&&(g.value=1)},close(i){a.closeDisclosure();let u=i?i instanceof HTMLElement?i:i.value instanceof HTMLElement?I(i):I(a.button):I(a.button);u==null||u.focus()}};return re(ce,a),_e(F(()=>ee(g.value,{0:U.Open,1:U.Closed}))),()=>{let{defaultOpen:i,...u}=e,m={open:g.value===0,close:a.close};return X({theirProps:u,ourProps:{},slot:m,slots:f,attrs:h,name:"Disclosure"})}}}),je=Q({name:"DisclosureButton",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:null}},setup(e,{attrs:f,slots:h,expose:g}){let s=J("DisclosureButton"),_=Ae(),a=F(()=>_===null?!1:_.value===s.panelId.value);ne(()=>{a.value||e.id!==null&&(s.buttonId.value=e.id)}),ie(()=>{a.value||(s.buttonId.value=null)});let i=P(null);g({el:i,$el:i}),a.value||be(()=>{s.button.value=i.value});let u=Fe(F(()=>({as:e.as,type:f.type})),i);function m(){var p;e.disabled||(a.value?(s.toggleDisclosure(),(p=I(s.button))==null||p.focus()):s.toggleDisclosure())}function w(p){var E;if(!e.disabled)if(a.value)switch(p.key){case B.Space:case B.Enter:p.preventDefault(),p.stopPropagation(),s.toggleDisclosure(),(E=I(s.button))==null||E.focus();break}else switch(p.key){case B.Space:case B.Enter:p.preventDefault(),p.stopPropagation(),s.toggleDisclosure();break}}function N(p){switch(p.key){case B.Space:p.preventDefault();break}}return()=>{var p;let E={open:s.disclosureState.value===0},{id:o,...r}=e,n=a.value?{ref:i,type:u.value,onClick:m,onKeydown:w}:{id:(p=s.buttonId.value)!=null?p:o,ref:i,type:u.value,"aria-expanded":s.disclosureState.value===0,"aria-controls":s.disclosureState.value===0||I(s.panel)?s.panelId.value:void 0,disabled:e.disabled?!0:void 0,onClick:m,onKeydown:w,onKeyup:N};return X({ourProps:n,theirProps:r,slot:E,attrs:f,slots:h,name:"DisclosureButton"})}}}),Ke=Q({name:"DisclosurePanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(e,{attrs:f,slots:h,expose:g}){let s=J("DisclosurePanel");ne(()=>{e.id!==null&&(s.panelId.value=e.id)}),ie(()=>{s.panelId.value=null}),g({el:s.panel,$el:s.panel}),re(de,s.panelId);let _=ke(),a=F(()=>_!==null?(_.value&U.Open)===U.Open:s.disclosureState.value===0);return()=>{var i;let u={open:s.disclosureState.value===0,close:s.close},{id:m,...w}=e,N={id:(i=s.panelId.value)!=null?i:m,ref:s.panel};return X({ourProps:N,theirProps:w,slot:u,attrs:f,slots:h,features:te.RenderStrategy|te.Static,visible:a.value,name:"DisclosurePanel"})}}});const He={class:"space-y-4 text-base"},Qe={key:0},Xe={class:"mb-4"},Je={key:1,class:""},Ye={class:"flex items-center"},Ze={class:"border rounded-md p-2 mr-2"},Ge={class:"flex flex-col"},We={class:"text-ink-gray-9"},et={class:"text-sm text-ink-gray-4 mt-1"},tt={__name:"ChapterModal",props:ve({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(e){const f=ae(e,"modelValue"),h=ae(e,"outline"),g=A("$user"),{updateOnboardingStep:s}=he("learning"),_=e,a=ye({title:"",is_scorm_package:0,scorm_package:null}),i=M({url:"lms.lms.api.upsert_chapter",makeParams(o){var r;return{title:a.title,course:_.course,is_scorm_package:a.is_scorm_package,scorm_package:a.scorm_package,name:(r=_.chapterDetail)==null?void 0:r.name}}}),u=M({url:"frappe.client.insert",makeParams(o){return{doc:{doctype:"Chapter Reference",chapter:o.name,parent:_.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),m=async o=>{i.submit({},{validate(){return w()},onSuccess:r=>{var n;(n=g.data)!=null&&n.is_system_manager&&s("create_first_chapter"),Pe("chapter_created"),u.submit({name:r.name},{onSuccess(O){N(),h.value.reload(),S.success(__("Chapter added successfully"))},onError(O){var V;S.error(((V=O.messages)==null?void 0:V[0])||O)}}),o()},onError(r){var n;S.error(((n=r.messages)==null?void 0:n[0])||r)}})},w=()=>{if(!a.title)return __("Title is required");if(a.is_scorm_package&&!a.scorm_package)return __("Please upload a SCORM package")},N=()=>{a.title="",a.is_scorm_package=0,a.scorm_package=null},p=o=>{i.submit({},{validate(){if(!a.title)return"Title is required"},onSuccess(){h.value.reload(),S.success(__("Chapter updated successfully")),o()},onError(r){var n;S.error(((n=r.messages)==null?void 0:n[0])||r)}})};K(()=>_.chapterDetail,o=>{a.title=o==null?void 0:o.title,a.is_scorm_package=o==null?void 0:o.is_scorm_package,a.scorm_package=o==null?void 0:o.scorm_package});const E=o=>{if(o.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(o,r)=>(d(),b(l(Ee),{modelValue:f.value,"onUpdate:modelValue":r[4]||(r[4]=n=>f.value=n),options:{title:e.chapterDetail?o.__("Edit Chapter"):o.__("Add Chapter"),size:"lg",actions:[{label:e.chapterDetail?o.__("Edit"):o.__("Create"),variant:"solid",onClick:n=>e.chapterDetail?p(n):m(n)}]}},{"body-content":v(()=>[k("div",He,[x(l(Ce),{label:"Title",modelValue:a.title,"onUpdate:modelValue":r[0]||(r[0]=n=>a.title=n),required:!0},null,8,["modelValue"]),x(l(xe),{size:"sm",label:o.__("SCORM Package"),description:o.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:a.is_scorm_package,"onUpdate:modelValue":r[1]||(r[1]=n=>a.is_scorm_package=n)},null,8,["label","description","modelValue"]),a.is_scorm_package?(d(),T("div",Qe,[a.scorm_package?(d(),T("div",Je,[k("div",Ye,[k("div",Ze,[x(l(ue),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),k("div",Ge,[k("span",We,$(a.scorm_package.file_name),1),k("span",et,$(l(Se)(a.scorm_package.file_size)),1)]),x(l(we),{onClick:r[3]||(r[3]=()=>a.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(d(),b(l(De),{key:0,fileTypes:[".zip"],validateFile:E,onSuccess:r[2]||(r[2]=n=>a.scorm_package=n)},{default:v(({file:n,progress:O,uploading:V,openFileSelector:q})=>[k("div",Xe,[x(l(H),{onClick:q,loading:V},{default:v(()=>[z($(V?`Uploading ${O}%`:"Upload an ZIP file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):y("",!0)])]),_:1},8,["modelValue","options"]))}},at={class:""},st={class:"chapter-item"},lt=["onClick"],ot={class:"flex ml-auto space-x-4"},rt={class:"flex items-center text-sm leading-5 group"},nt={key:1,class:"flex mt-2 mb-4 pl-8"},mt={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1},lessonProgress:{type:Number,default:0}},setup(e){const f=$e(),h=Ne(),g=A("$user"),s=P(!1),_=P(null),a=Oe(),{$dialog:i}=a.appContext.config.globalProperties,u=e,m=M({url:"lms.lms.utils.get_course_outline",cache:["course_outline",u.courseName],makeParams(){return{course:u.courseName,progress:u.getProgress}},auto:!0});K(()=>u.courseName,()=>{m.reload()}),K(()=>u.lessonProgress,()=>{m.reload()});const w=M({url:"lms.lms.api.delete_lesson",makeParams(t){return{lesson:t.lesson,chapter:t.chapter}},onSuccess(){m.reload(),S.success(__("Lesson deleted successfully"))}}),N=M({url:"lms.lms.api.update_lesson_index",makeParams(t){return{lesson:t.lesson,sourceChapter:t.sourceChapter,targetChapter:t.targetChapter,idx:t.idx}},onSuccess(){S.success(__("Lesson moved successfully"))}}),p=M({url:"lms.lms.api.update_chapter_index",makeParams(t){return{chapter:t.chapter,course:t.course,idx:t.idx}},onSuccess(){S.success(__("Chapter moved successfully"))}}),E=(t,D)=>{i({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(R){w.submit({lesson:t,chapter:D}),R()}}]})},o=t=>t==f.params.chapterNumber||t==1,r=(t=null)=>{_.value=t,s.value=!0},n=()=>_.value,O=t=>{N.submit({lesson:t.item.__draggable_context.element.name,sourceChapter:t.from.dataset.chapter,targetChapter:t.to.dataset.chapter,idx:t.newIndex})},V=t=>{p.submit({chapter:t.item.__draggable_context.element.name,course:u.courseName,idx:t.newIndex})},q=M({url:"lms.lms.api.delete_chapter",makeParams(t){return{chapter:t.chapter}},onSuccess(){m.reload(),S.success(__("Chapter deleted successfully"))}}),me=t=>{i({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(D){q.submit({chapter:t}),D()}}]})},pe=t=>{if(t.is_scorm_package&&(event.preventDefault(),!u.allowEdit)){if(!g.data){S.success(__("Please enroll for this course to view this lesson"));return}h.push({name:"SCORMChapter",params:{courseName:u.courseName,chapterName:t.name}})}},fe=t=>f.params.chapterNumber==t.split("-")[0]&&f.params.lessonNumber==t.split("-")[1];return(t,D)=>{var Y,Z;const R=Ve("router-link");return d(),T(ze,null,[k("div",at,[e.title&&((Y=l(m).data)!=null&&Y.length||e.allowEdit)?(d(),T("div",{key:0,class:L(["flex items-center justify-between space-x-2 mb-4 px-2",{"sticky top-0 z-10 bg-surface-white border-b px-3 py-2.5 sm:px-5":e.allowEdit}])},[k("div",{class:L(["font-semibold text-lg leading-5 text-ink-gray-9",{"font-medium text-p-base":e.allowEdit}])},$(t.__(e.title)),3),e.allowEdit?(d(),b(l(H),{key:0,size:"sm",onClick:D[0]||(D[0]=c=>r())},{default:v(()=>[z($(t.__("Add Chapter")),1)]),_:1})):y("",!0)],2)):y("",!0),k("div",{class:L({"border-2 rounded-md py-2 px-2":e.showOutline&&((Z=l(m).data)==null?void 0:Z.length)})},[x(l(oe),{list:l(m).data,disabled:!e.allowEdit,"item-key":"name",group:"chapters",onEnd:V},{item:v(({element:c,index:ge})=>[k("div",st,[(d(),b(l(qe),{key:c.name,defaultOpen:o(c.idx)},{default:v(({open:G})=>[x(l(je),{ref:"",class:"flex items-center w-full p-2 group"},{default:v(()=>[x(l(Me),{class:L([{"rotate-90 transform duration-200":G,"duration-200":!G,hidden:c.is_scorm_package,open:ge==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),k("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:C=>pe(c)},$(c.title),9,lt),k("div",ot,[x(l(se),{text:t.__("Edit Chapter"),placement:"bottom"},{default:v(()=>[e.allowEdit?(d(),b(l(Ie),{key:0,onClick:j(C=>r(c),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):y("",!0)]),_:2},1032,["text"]),x(l(se),{text:t.__("Delete Chapter"),placement:"bottom"},{default:v(()=>[e.allowEdit?(d(),b(l(le),{key:0,onClick:j(C=>me(c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):y("",!0)]),_:2},1032,["text"])])]),_:2},1536),c.is_scorm_package?y("",!0):(d(),b(l(Ke),{key:0},{default:v(()=>[c.is_scorm_package?y("",!0):(d(),b(l(oe),{key:0,list:c.lessons,disabled:!e.allowEdit,"item-key":"name",group:"items",onEnd:O,"data-chapter":c.name},{item:v(({element:C})=>[k("div",{class:L(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",fe(C.number)?"bg-surface-gray-3":""])},[x(R,{to:{name:e.allowEdit?"LessonForm":"Lesson",params:{courseName:e.courseName,chapterNumber:C.number.split("-")[0],lessonNumber:C.number.split("-")[1]}}},{default:v(()=>[k("div",rt,[C.icon==="icon-youtube"?(d(),b(l(Be),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-quiz"?(d(),b(l(Le),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):C.icon==="icon-list"?(d(),b(l(ue),{key:2,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):y("",!0),z(" "+$(C.title)+" ",1),e.allowEdit?(d(),b(l(le),{key:3,onClick:j(it=>E(C.name,c.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):y("",!0),C.is_complete?(d(),b(l(Te),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):y("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),e.allowEdit?(d(),T("div",nt,[c.is_scorm_package?y("",!0):(d(),b(R,{key:0,to:{name:"LessonForm",params:{courseName:e.courseName,chapterNumber:c.idx,lessonNumber:c.lessons.length+1}}},{default:v(()=>[x(l(H),null,{default:v(()=>[z($(t.__("Add Lesson")),1)]),_:1})]),_:1},8,["to"]))])):y("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))])]),_:1},8,["list","disabled"])],2)]),l(g).data?(d(),b(tt,{key:0,modelValue:s.value,"onUpdate:modelValue":D[1]||(D[1]=c=>s.value=c),outline:l(m),"onUpdate:outline":D[2]||(D[2]=c=>Re(m)?m.value=c:null),course:e.courseName,chapterDetail:n()},null,8,["modelValue","outline","course","chapterDetail"])):y("",!0)],64)}}};export{mt as _};
//# sourceMappingURL=CourseOutline-CFCV-q58.js.map
