import{s as X,v as H,y as I,i as Y,aN as Z,ac as B,c as h,J,h as q,o as d,w as m,e as r,a as _,b as k,t as f,f as u,u as s,aY as G,aj as W,Q as c,F as S,g as P,aK as ee,p as $,l as z,D as se,aa as g,x as te,z as le,q as oe,aD as ae,ar as ne,B as K,E as ie,a3 as ue,cM as de,r as re,c4 as me,P as ce,U as _e,T as pe,Y as be,Z as fe,X as ye,ao as ke,aM as ve,S as qe,ad as ge,cC as Ve}from"./index-C4szjxrb.js";import{_ as we}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";const he={class:"p-5 space-y-5"},$e={class:"text-lg font-semibold text-ink-gray-9 mb-5"},ze={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},Qe={key:1},xe={class:"block text-xs text-ink-gray-5 mb-1"},Se={class:"grid grid-cols-2 gap-8 mt-4"},Me={key:0,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-10"},Ue={key:1,class:"text-base font-semibold text-ink-gray-9 mb-5 mt-5"},De={key:2,class:"grid grid-cols-2 gap-x-8 gap-y-4"},Ce={class:"space-y-4 py-2"},Le={key:3,class:"grid grid-cols-2 gap-x-8 gap-y-4 py-2"},Ee={key:2,class:"space-y-2"},Ie={class:"flex items-center justify-end space-x-2 mt-5"},Pe={__name:"Question",props:X({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(Q){const v=H(Q,"modelValue"),V=H(Q,"quiz"),p=I(!1),w=I(!1),T=Y("$user"),{updateOnboardingStep:M}=Z("learning"),b=B({question:"",marks:1}),n=B({question:"",type:"Choices",marks:1}),x=()=>{let e=["option","is_correct","explanation","possibility"],o=1;e.forEach(a=>{for(;o<=4;)n[`${a}_${o}`]=a==="is_correct"?!1:null,o++})};x();const l=Q,U=h({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:l.questionDetail.question}},auto:!1,onSuccess(e){let o=1;for(w.value=!0,Object.keys(e).forEach(a=>{Object.hasOwn(n,a)&&(n[a]=e[a])});o<=4;)n[`is_correct_${o}`]=!!e[`is_correct_${o}`],o++;n.marks=l.questionDetail.marks}});J(v,()=>{v.value&&(w.value=!1,l.questionDetail.question?U.fetch():(n.question="",n.marks=1,n.type="Choices",b.question="",b.marks=1,p.value=!1,x()),l.questionDetail.marks&&(n.marks=l.questionDetail.marks))});const D=h({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Quiz Question",parent:V.value.doc.name,parentfield:"questions",parenttype:"LMS Quiz",...e}}}}),N=h({url:"frappe.client.insert",makeParams(e){return{doc:{doctype:"LMS Question",...n}}}}),C=()=>{var e;(e=l.questionDetail)!=null&&e.question?t():L()},L=()=>{p.value?E({question:b.question,marks:b.marks}):N.submit({},{onSuccess(e){E({question:e.name,marks:n.marks})},onError(e){var o;g.error(((o=e.messages)==null?void 0:o[0])||e)}})},E=e=>{D.submit({...e},{onSuccess(){var o;(o=T.data)!=null&&o.is_system_manager&&M("create_first_quiz"),v.value=!1,g.success(__("Question added successfully")),V.value.reload(),v.value=!1},onError(o){var a;g.error(((a=o.messages)==null?void 0:a[0])||o),v.value=!1}})},O=h({url:"frappe.client.set_value",auto:!1,makeParams(e){var o;return{doctype:"LMS Question",name:(o=U.data)==null?void 0:o.name,fieldname:{...n}}}}),j=h({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz Question",name:l.questionDetail.name,fieldname:{marks:n.marks}}}}),t=()=>{O.submit({},{onSuccess(){j.submit({},{onSuccess(){v.value=!1,g.success(__("Question updated successfully")),V.value.reload()}})},onError(e){var o;g.error(((o=e.messages)==null?void 0:o[0])||e)}})};return(e,o)=>(d(),q(s(se),{modelValue:v.value,"onUpdate:modelValue":o[7]||(o[7]=a=>v.value=a),options:{size:"5xl"}},{body:m(()=>[r("div",he,[r("div",$e,f(e.__(l.title)),1),w.value?k("",!0):(d(),_("div",ze,[u(s(G),{size:"sm",label:e.__("Choose an existing question"),modelValue:p.value,"onUpdate:modelValue":o[0]||(o[0]=a=>p.value=a),class:"!p-0"},null,8,["label","modelValue"])])),!p.value||w.value?(d(),_("div",Qe,[r("div",null,[r("label",xe,f(e.__("Question")),1),u(s(W),{content:n.question,onChange:o[1]||(o[1]=a=>n.question=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r("div",Se,[u(s(c),{modelValue:n.marks,"onUpdate:modelValue":o[2]||(o[2]=a=>n.marks=a),label:e.__("Marks"),type:"number"},null,8,["modelValue","label"]),u(s(c),{label:e.__("Type"),modelValue:n.type,"onUpdate:modelValue":o[3]||(o[3]=a=>n.type=a),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"])]),n.type=="Choices"?(d(),_("div",Me,f(e.__("Options")),1)):n.type=="User Input"?(d(),_("div",Ue,f(e.__("Possibilities")),1)):k("",!0),n.type=="Choices"?(d(),_("div",De,[(d(),_(S,null,P(4,a=>r("div",Ce,[u(s(c),{label:e.__("Option")+" "+a,modelValue:n[`option_${a}`],"onUpdate:modelValue":y=>n[`option_${a}`]=y,required:a<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),u(s(c),{label:e.__("Explanation"),modelValue:n[`explanation_${a}`],"onUpdate:modelValue":y=>n[`explanation_${a}`]=y},null,8,["label","modelValue","onUpdate:modelValue"]),u(s(c),{label:e.__("Correct Answer"),modelValue:n[`is_correct_${a}`],"onUpdate:modelValue":y=>n[`is_correct_${a}`]=y,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):n.type=="User Input"?(d(),_("div",Le,[(d(),_(S,null,P(4,a=>r("div",null,[u(s(c),{label:e.__("Possibility")+" "+a,modelValue:n[`possibility_${a}`],"onUpdate:modelValue":y=>n[`possibility_${a}`]=y,required:a==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64))])):k("",!0)])):p.value?(d(),_("div",Ee,[u(ee,{modelValue:b.question,"onUpdate:modelValue":o[4]||(o[4]=a=>b.question=a),label:e.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),u(s(c),{modelValue:b.marks,"onUpdate:modelValue":o[5]||(o[5]=a=>b.marks=a),label:e.__("Marks"),type:"number"},null,8,["modelValue","label"])])):k("",!0),r("div",Ie,[u(s($),{variant:"solid",onClick:o[6]||(o[6]=a=>C())},{default:m(()=>[z(f(e.__("Save")),1)]),_:1})])])]),_:1},8,["modelValue"]))}},Te={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={key:0,class:"flex items-center space-x-2"},Oe={key:0,class:"py-5"},je={class:"px-20 pb-5 space-y-5 border-b mb-5"},Re={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ae={class:"grid grid-cols-2 gap-5"},Be={class:"space-y-5"},Fe={class:"space-y-5"},He={class:"px-20 pb-5 space-y-5 border-b mb-5"},Ke={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ye={class:"grid grid-cols-3 gap-5"},Je={class:"flex flex-col space-y-10"},Xe={class:"flex flex-col space-y-5"},Ze={class:"flex flex-col space-y-5"},Ge={class:"px-20 pb-5 space-y-5 mb-5"},We={class:"flex items-center justify-between mb-4"},es={class:"text-lg font-semibold text-ink-gray-9"},ss=["innerHTML"],ts={key:1,class:"text-xs"},ls={class:"flex gap-2"},os={key:1,class:"text-ink-gray-6 text-sm"},is={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(Q){const{brand:v}=te(),V=I(!1),p=B({question:"",marks:0,name:""}),w=Y("$user"),T=oe(),M=window.read_only_mode,b=Q,n=I([]);le(()=>{var t,e;!((t=w.data)!=null&&t.is_moderator)&&!((e=w.data)!=null&&e.is_instructor)&&T.push({name:"Courses"}),b.quizID!=="new"&&l.reload(),window.addEventListener("keydown",x)});const x=t=>{t.key==="s"&&(t.ctrlKey||t.metaKey)&&(D(),t.preventDefault())};ne(()=>{window.removeEventListener("keydown",x)}),J(()=>b.quizID!=="new",t=>{t&&l.reload()});const l=ae({doctype:"LMS Quiz",name:b.quizID,auto:!1,onSuccess(t){t.questions&&t.questions.length>0&&(n.value=t.questions.map(e=>e))}}),U=()=>{l.doc.title=Ve(l.doc.title.trim())},D=()=>{U(),l.setValue.submit({...l.doc,total_marks:N()},{onSuccess(t){l.doc.total_marks=t.total_marks,g.success(__("Quiz updated successfully"))},onError(t){var e;g.error(((e=t.messages)==null?void 0:e[0])||t)}})},N=()=>{var e,o,a;let t=0;return(e=l.doc)!=null&&e.limit_questions_to&&((o=l.doc)==null?void 0:o.questions.length)>0?l.doc.questions[0].marks*l.doc.limit_questions_to:((a=l.doc)==null||a.questions.forEach(y=>{t+=y.marks}),t)},C=K(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),L=(t=null)=>{t?(p.question=t.question,p.marks=t.marks,p.name=t.name):(p.question="",p.marks=0,p.name=""),V.value=!0},E=h({url:"lms.lms.api.delete_documents",makeParams(t){return{doctype:"LMS Quiz Question",documents:t.questions}}}),O=(t,e)=>{E.submit({questions:Array.from(t)},{onSuccess(){g.success(__("Questions deleted successfully")),l.reload(),e()}})},j=K(()=>{var e;let t=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return t.push({label:b.quizID=="new"?__("New Quiz"):(e=l.doc)==null?void 0:e.title,route:{name:"QuizForm",params:{quizID:b.quizID}}}),t});return ie(()=>{var t;return{title:b.quizID=="new"?__("New Quiz"):(t=l.doc)==null?void 0:t.title,icon:v.favicon}}),(t,e)=>{var a,y;const o=re("router-link");return d(),_(S,null,[r("header",Te,[u(s(we),{items:j.value},null,8,["items"]),s(M)?k("",!0):(d(),_("div",Ne,[s(l).isDirty?(d(),q(s(ue),{key:0,theme:"orange"},{default:m(()=>[z(f(t.__("Not Saved")),1)]),_:1})):k("",!0),(a=s(l).doc)!=null&&a.name?(d(),q(o,{key:1,to:{name:"QuizPage",params:{quizID:s(l).doc.name}}},{default:m(()=>[u(s($),null,{prefix:m(()=>[u(s(de),{class:"size-4 stroke-1.5"})]),default:m(()=>[z(" "+f(t.__("Test Quiz")),1)]),_:1})]),_:1},8,["to"])):k("",!0),(y=s(l).doc)!=null&&y.name?(d(),q(o,{key:2,to:{name:"QuizSubmissionList",params:{quizID:s(l).doc.name}}},{default:m(()=>[u(s($),null,{prefix:m(()=>[u(s(me),{class:"size-4 stroke-1.5"})]),default:m(()=>[z(" "+f(t.__("Check Submissions")),1)]),_:1})]),_:1},8,["to"])):k("",!0),u(s($),{variant:"solid",onClick:e[0]||(e[0]=i=>D())},{default:m(()=>[z(f(t.__("Save")),1)]),_:1})]))]),s(l).doc?(d(),_("div",Oe,[r("div",je,[r("div",Re,f(t.__("Details")),1),r("div",Ae,[r("div",Be,[u(s(c),{modelValue:s(l).doc.title,"onUpdate:modelValue":e[1]||(e[1]=i=>s(l).doc.title=i),label:t.__("Title"),required:!0},null,8,["modelValue","label"]),u(s(c),{type:"number",modelValue:s(l).doc.max_attempts,"onUpdate:modelValue":e[2]||(e[2]=i=>s(l).doc.max_attempts=i),label:t.__("Maximum Attempts")},null,8,["modelValue","label"]),u(s(c),{type:"number",modelValue:s(l).doc.duration,"onUpdate:modelValue":e[3]||(e[3]=i=>s(l).doc.duration=i),label:t.__("Duration (in minutes)")},null,8,["modelValue","label"])]),r("div",Fe,[u(s(c),{modelValue:s(l).doc.total_marks,"onUpdate:modelValue":e[4]||(e[4]=i=>s(l).doc.total_marks=i),label:t.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),u(s(c),{modelValue:s(l).doc.passing_percentage,"onUpdate:modelValue":e[5]||(e[5]=i=>s(l).doc.passing_percentage=i),label:t.__("Passing Percentage"),required:!0},null,8,["modelValue","label"])])])]),r("div",He,[r("div",Ke,f(t.__("Settings")),1),r("div",Ye,[r("div",Je,[u(s(c),{modelValue:s(l).doc.show_answers,"onUpdate:modelValue":e[6]||(e[6]=i=>s(l).doc.show_answers=i),type:"checkbox",label:t.__("Show Answers")},null,8,["modelValue","label"]),u(s(c),{modelValue:s(l).doc.show_submission_history,"onUpdate:modelValue":e[7]||(e[7]=i=>s(l).doc.show_submission_history=i),type:"checkbox",label:t.__("Show Submission History")},null,8,["modelValue","label"])]),r("div",Xe,[u(s(c),{modelValue:s(l).doc.shuffle_questions,"onUpdate:modelValue":e[8]||(e[8]=i=>s(l).doc.shuffle_questions=i),type:"checkbox",label:t.__("Shuffle Questions")},null,8,["modelValue","label"]),s(l).doc.shuffle_questions?(d(),q(s(c),{key:0,modelValue:s(l).doc.limit_questions_to,"onUpdate:modelValue":e[9]||(e[9]=i=>s(l).doc.limit_questions_to=i),label:t.__("Limit Questions To")},null,8,["modelValue","label"])):k("",!0)]),r("div",Ze,[u(s(c),{modelValue:s(l).doc.enable_negative_marking,"onUpdate:modelValue":e[10]||(e[10]=i=>s(l).doc.enable_negative_marking=i),type:"checkbox",label:t.__("Enable Negative Marking")},null,8,["modelValue","label"]),s(l).doc.enable_negative_marking?(d(),q(s(c),{key:0,modelValue:s(l).doc.marks_to_cut,"onUpdate:modelValue":e[11]||(e[11]=i=>s(l).doc.marks_to_cut=i),label:t.__("Marks to Deduct")},null,8,["modelValue","label"])):k("",!0)])])]),r("div",Ge,[r("div",We,[r("div",es,f(t.__("Questions")),1),s(M)?k("",!0):(d(),q(s($),{key:0,onClick:e[12]||(e[12]=i=>L())},{prefix:m(()=>[u(s(ce),{class:"w-4 h-4"})]),default:m(()=>[z(" "+f(t.__("New Question")),1)]),_:1}))]),n.value.length?(d(),q(s(qe),{key:0,columns:C.value,rows:n.value,"row-key":"name",options:{showTooltip:!1}},{default:m(()=>[u(s(pe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:m(()=>[(d(!0),_(S,null,P(C.value,i=>(d(),q(s(_e),{item:i},null,8,["item"]))),256))]),_:1}),u(s(ye),null,{default:m(()=>[(d(!0),_(S,null,P(n.value,i=>(d(),q(s(be),{row:i,onClick:R=>L(i),class:"cursor-pointer"},{default:m(({idx:R,column:F,item:A})=>[u(s(fe),{item:A},{default:m(()=>[F.key=="question_detail"?(d(),_("div",{key:0,class:"text-xs truncate h-4",innerHTML:A},null,8,ss)):(d(),_("div",ts,f(A),1))]),_:2},1032,["item"])]),_:1},8,["row","onClick"]))),256))]),_:1}),u(s(ve),null,{actions:m(({unselectAll:i,selections:R})=>[r("div",ls,[u(s($),{variant:"ghost",onClick:F=>O(R,i)},{default:m(()=>[u(s(ke),{class:"h-4 w-4 stroke-1.5"})]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])):(d(),_("div",os,f(t.__("No questions added yet")),1))])])):k("",!0),u(Pe,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=i=>V.value=i),questionDetail:p,quiz:s(l),"onUpdate:quiz":e[14]||(e[14]=i=>ge(l)?l.value=i:null),title:p.question?t.__("Edit the question"):t.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{is as default};
//# sourceMappingURL=QuizForm-CvvEx34m.js.map
