import{y as S,ba as k,d as A,bb as H,B as $,bc as V,bd as _,az as R,be as C,bf as se,bg as ne,bh as T,bi as z,bj as oe,bk as K,bl as W,z as re,b6 as ue,bm as ie,bn as ce,bo as de,bp as ve,bq as me,br as fe,bs as pe,bt as be,bu as ge,i as Y,bv as he,s as _e,v as q,c as Z,J as ye,h as O,o as y,w as D,e as h,f as I,a as w,u,Q as ke,t as M,F,g as L,C as X,bw as xe,n as ee,k as U,D as Ie,aa as J,A as te,aV as Me,b as P,l as j,p as N,bx as Se,by as we,bz as Ce,j as De,G as $e,bA as Re,ad as Ee}from"./index-C4szjxrb.js";import{s as Pe}from"./use-resolve-button-type-WYY12HT4.js";let Q=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function G(a){var f,i;let v=(f=a.innerText)!=null?f:"",c=a.cloneNode(!0);if(!(c instanceof HTMLElement))return v;let s=!1;for(let p of c.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))p.remove(),s=!0;let e=s?(i=c.innerText)!=null?i:"":v;return Q.test(e)&&(e=e.replace(Q,"")),e}function Te(a){let f=a.getAttribute("aria-label");if(typeof f=="string")return f.trim();let i=a.getAttribute("aria-labelledby");if(i){let v=i.split(" ").map(c=>{let s=document.getElementById(c);if(s){let e=s.getAttribute("aria-label");return typeof e=="string"?e.trim():G(s).trim()}return null}).filter(Boolean);if(v.length>0)return v.join(", ")}return G(a).trim()}function Fe(a){let f=S(""),i=S("");return()=>{let v=k(a);if(!v)return"";let c=v.innerText;if(f.value===c)return i.value;let s=Te(v).trim().toLowerCase();return f.value=c,i.value=s,s}}var Ae=(a=>(a[a.Open=0]="Open",a[a.Closed=1]="Closed",a))(Ae||{}),Ve=(a=>(a[a.Pointer=0]="Pointer",a[a.Other=1]="Other",a))(Ve||{});function Be(a){requestAnimationFrame(()=>requestAnimationFrame(a))}let ae=Symbol("MenuContext");function B(a){let f=Y(ae,null);if(f===null){let i=new Error(`<${a} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(i,B),i}return f}let je=A({name:"Menu",props:{as:{type:[Object,String],default:"template"}},setup(a,{slots:f,attrs:i}){let v=S(1),c=S(null),s=S(null),e=S([]),p=S(""),d=S(null),x=S(1);function r(t=n=>n){let n=d.value!==null?e.value[d.value]:null,o=he(t(e.value.slice()),m=>k(m.dataRef.domRef)),b=n?o.indexOf(n):null;return b===-1&&(b=null),{items:o,activeItemIndex:b}}let l={menuState:v,buttonRef:c,itemsRef:s,items:e,searchQuery:p,activeItemIndex:d,activationTrigger:x,closeMenu:()=>{v.value=1,d.value=null},openMenu:()=>v.value=0,goToItem(t,n,o){let b=r(),m=ge(t===C.Specific?{focus:C.Specific,id:n}:{focus:t},{resolveItems:()=>b.items,resolveActiveIndex:()=>b.activeItemIndex,resolveId:g=>g.id,resolveDisabled:g=>g.dataRef.disabled});p.value="",d.value=m,x.value=o??1,e.value=b.items},search(t){let n=p.value!==""?0:1;p.value+=t.toLowerCase();let o=(d.value!==null?e.value.slice(d.value+n).concat(e.value.slice(0,d.value+n)):e.value).find(m=>m.dataRef.textValue.startsWith(p.value)&&!m.dataRef.disabled),b=o?e.value.indexOf(o):-1;b===-1||b===d.value||(d.value=b,x.value=1)},clearSearch(){p.value=""},registerItem(t,n){let o=r(b=>[...b,{id:t,dataRef:n}]);e.value=o.items,d.value=o.activeItemIndex,x.value=1},unregisterItem(t){let n=r(o=>{let b=o.findIndex(m=>m.id===t);return b!==-1&&o.splice(b,1),o});e.value=n.items,d.value=n.activeItemIndex,x.value=1}};return de([c,s],(t,n)=>{var o;l.closeMenu(),ve(n,me.Loose)||(t.preventDefault(),(o=k(c))==null||o.focus())},$(()=>v.value===0)),fe(ae,l),pe($(()=>be(v.value,{0:T.Open,1:T.Closed}))),()=>{let t={open:v.value===0,close:l.closeMenu};return V({ourProps:{},theirProps:a,slot:t,slots:f,attrs:i,name:"Menu"})}}}),Ne=A({name:"MenuButton",props:{disabled:{type:Boolean,default:!1},as:{type:[Object,String],default:"button"},id:{type:String,default:null}},setup(a,{attrs:f,slots:i,expose:v}){var c;let s=(c=a.id)!=null?c:`headlessui-menu-button-${H()}`,e=B("MenuButton");v({el:e.buttonRef,$el:e.buttonRef});function p(l){switch(l.key){case _.Space:case _.Enter:case _.ArrowDown:l.preventDefault(),l.stopPropagation(),e.openMenu(),R(()=>{var t;(t=k(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(C.First)});break;case _.ArrowUp:l.preventDefault(),l.stopPropagation(),e.openMenu(),R(()=>{var t;(t=k(e.itemsRef))==null||t.focus({preventScroll:!0}),e.goToItem(C.Last)});break}}function d(l){switch(l.key){case _.Space:l.preventDefault();break}}function x(l){a.disabled||(e.menuState.value===0?(e.closeMenu(),R(()=>{var t;return(t=k(e.buttonRef))==null?void 0:t.focus({preventScroll:!0})})):(l.preventDefault(),e.openMenu(),Be(()=>{var t;return(t=k(e.itemsRef))==null?void 0:t.focus({preventScroll:!0})})))}let r=Pe($(()=>({as:a.as,type:f.type})),e.buttonRef);return()=>{var l;let t={open:e.menuState.value===0},{...n}=a,o={ref:e.buttonRef,id:s,type:r.value,"aria-haspopup":"menu","aria-controls":(l=k(e.itemsRef))==null?void 0:l.id,"aria-expanded":e.menuState.value===0,onKeydown:p,onKeyup:d,onClick:x};return V({ourProps:o,theirProps:n,slot:t,attrs:f,slots:i,name:"MenuButton"})}}}),Oe=A({name:"MenuItems",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:null}},setup(a,{attrs:f,slots:i,expose:v}){var c;let s=(c=a.id)!=null?c:`headlessui-menu-items-${H()}`,e=B("MenuItems"),p=S(null);v({el:e.itemsRef,$el:e.itemsRef}),se({container:$(()=>k(e.itemsRef)),enabled:$(()=>e.menuState.value===0),accept(t){return t.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:t.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(t){t.setAttribute("role","none")}});function d(t){var n;switch(p.value&&clearTimeout(p.value),t.key){case _.Space:if(e.searchQuery.value!=="")return t.preventDefault(),t.stopPropagation(),e.search(t.key);case _.Enter:if(t.preventDefault(),t.stopPropagation(),e.activeItemIndex.value!==null){let o=e.items.value[e.activeItemIndex.value];(n=k(o.dataRef.domRef))==null||n.click()}e.closeMenu(),W(k(e.buttonRef));break;case _.ArrowDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(C.Next);case _.ArrowUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(C.Previous);case _.Home:case _.PageUp:return t.preventDefault(),t.stopPropagation(),e.goToItem(C.First);case _.End:case _.PageDown:return t.preventDefault(),t.stopPropagation(),e.goToItem(C.Last);case _.Escape:t.preventDefault(),t.stopPropagation(),e.closeMenu(),R(()=>{var o;return(o=k(e.buttonRef))==null?void 0:o.focus({preventScroll:!0})});break;case _.Tab:t.preventDefault(),t.stopPropagation(),e.closeMenu(),R(()=>oe(k(e.buttonRef),t.shiftKey?K.Previous:K.Next));break;default:t.key.length===1&&(e.search(t.key),p.value=setTimeout(()=>e.clearSearch(),350));break}}function x(t){switch(t.key){case _.Space:t.preventDefault();break}}let r=ne(),l=$(()=>r!==null?(r.value&T.Open)===T.Open:e.menuState.value===0);return()=>{var t,n;let o={open:e.menuState.value===0},{...b}=a,m={"aria-activedescendant":e.activeItemIndex.value===null||(t=e.items.value[e.activeItemIndex.value])==null?void 0:t.id,"aria-labelledby":(n=k(e.buttonRef))==null?void 0:n.id,id:s,onKeydown:d,onKeyup:x,role:"menu",tabIndex:0,ref:e.itemsRef};return V({ourProps:m,theirProps:b,slot:o,attrs:f,slots:i,features:z.RenderStrategy|z.Static,visible:l.value,name:"MenuItems"})}}}),Le=A({name:"MenuItem",inheritAttrs:!1,props:{as:{type:[Object,String],default:"template"},disabled:{type:Boolean,default:!1},id:{type:String,default:null}},setup(a,{slots:f,attrs:i,expose:v}){var c;let s=(c=a.id)!=null?c:`headlessui-menu-item-${H()}`,e=B("MenuItem"),p=S(null);v({el:p,$el:p});let d=$(()=>e.activeItemIndex.value!==null?e.items.value[e.activeItemIndex.value].id===s:!1),x=Fe(p),r=$(()=>({disabled:a.disabled,get textValue(){return x()},domRef:p}));re(()=>e.registerItem(s,r)),ue(()=>e.unregisterItem(s)),ie(()=>{e.menuState.value===0&&d.value&&e.activationTrigger.value!==0&&R(()=>{var g,E;return(E=(g=k(p))==null?void 0:g.scrollIntoView)==null?void 0:E.call(g,{block:"nearest"})})});function l(g){if(a.disabled)return g.preventDefault();e.closeMenu(),W(k(e.buttonRef))}function t(){if(a.disabled)return e.goToItem(C.Nothing);e.goToItem(C.Specific,s)}let n=ce();function o(g){n.update(g)}function b(g){n.wasMoved(g)&&(a.disabled||d.value||e.goToItem(C.Specific,s,0))}function m(g){n.wasMoved(g)&&(a.disabled||d.value&&e.goToItem(C.Nothing))}return()=>{let{disabled:g,...E}=a,le={active:d.value,disabled:g,close:e.closeMenu};return V({ourProps:{id:s,ref:p,role:"menuitem",tabIndex:g===!0?void 0:-1,"aria-disabled":g===!0?!0:void 0,onClick:l,onFocus:t,onPointerenter:o,onMouseenter:o,onPointermove:b,onMousemove:b,onPointerleave:m,onMouseleave:m},theirProps:{...i,...E},slot:le,attrs:i,slots:f,name:"MenuItem"})}}});const Ue={class:"flex flex-col gap-4 text-base max-h-[60vh]"},He={key:0,class:"space-y-4 overflow-y-auto mt-4"},Ye={class:"text-ink-gray-9 font-medium"},ze={class:"space-y-5"},Ke={class:"space-y-2"},qe={class:"flex items-center text-ink-gray-7 space-x-2"},Je={class:"text-ink-gray-9"},Qe={class:"text-ink-gray-5"},Ge={class:"grid grid-cols-3 gap-2"},We=["onClick"],Ze={key:1,class:"text-ink-red-3"},Xe={__name:"EvaluationModal",props:_e({courses:{type:Array,default:[]},batch:{type:String,default:null},endDate:{type:String,default:null}},{modelValue:{},modelModifiers:{},reloadEvals:{},reloadEvalsModifiers:{}}),emits:["update:modelValue","update:reloadEvals"],setup(a){const f=Y("$user"),i=q(a,"modelValue"),v=q(a,"reloadEvals"),c=a,s=S({course:"",date:"",start_time:"",end_time:"",day:"",batch:c.batch,member:f.data.name});function e(r){if(!s.value.date||!s.value.start_time){J.warning(__("Please select a slot for your evaluation."),{duration:10});return}te("frappe.client.insert",{doc:{doctype:"LMS Certificate Request",batch_name:s.value.batch,...s.value}}).then(()=>{v.value.reload(),r()}).catch(l=>{var t,n;console.log(((t=l.messages)==null?void 0:t[0])||l),J.warning(__(((n=l.messages)==null?void 0:n[0])||l),{duration:20})})}const p=()=>{const r=[];for(const l of c.courses)l.evaluator&&r.push({label:l.title,value:l.course});return r.length===1&&(s.value.course=r[0].value),r},d=Z({url:"lms.lms.doctype.course_evaluator.course_evaluator.get_schedule",makeParams(r){return{course:r.course,batch:c.batch}}});ye(()=>s.value.course,r=>{d.reload(s.value)});const x=(r,l)=>{s.value.start_time=r.start_time,s.value.end_time=r.end_time,s.value.date=l.date,s.value.day=l.day};return(r,l)=>(y(),O(u(Ie),{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=t=>i.value=t),options:{title:r.__("Schedule your evaluation"),size:"xl",actions:[{label:r.__("Submit"),variant:"solid",onClick:t=>e(t)}]}},{"body-content":D(()=>{var t;return[h("div",Ue,[I(u(ke),{modelValue:s.value.course,"onUpdate:modelValue":l[0]||(l[0]=n=>s.value.course=n),type:"select",label:r.__("Course"),options:p()},null,8,["modelValue","label","options"]),(t=u(d).data)!=null&&t.length?(y(),w("div",He,[h("div",Ye,M(r.__("Available Slots")),1),h("div",ze,[(y(!0),w(F,null,L(u(d).data,n=>(y(),w("div",Ke,[h("div",qe,[I(u(X),{class:"size-3"}),h("div",Je,M(u(xe)(n.date).format("DD MMMM YYYY")),1),l[2]||(l[2]=h("div",null,"Â·",-1)),h("div",Qe,M(n.day),1)]),h("div",Ge,[(y(!0),w(F,null,L(n.slots,o=>(y(),w("div",{class:ee(["text-base text-center border rounded-md text-ink-gray-8 p-2 cursor-pointer text-ink-gray-7 hover:bg-surface-gray-2 hover:border-outline-gray-3",{"border-outline-gray-4 text-ink-gray-9":s.value.date==n.date&&s.value.start_time==o.start_time}]),onClick:b=>x(o,n)},M(u(U)(o.start_time))+" - "+M(u(U)(o.end_time)),11,We))),256))])]))),256))])])):(y(),w("div",Ze,M(r.__("No slots available for the selected course.")),1))])]}),_:1},8,["modelValue","options"]))}},et={key:0},tt={class:"flex items-center justify-between mb-4"},at={class:"text-lg text-ink-gray-9 font-semibold"},lt={key:0},st={class:"border text-ink-gray-7 rounded-md p-3"},nt={class:"flex justify-between mb-3"},ot={class:"text-lg font-semibold text-ink-gray-9 leading-5"},rt={class:"flex items-center mb-2"},ut={class:"ml-2"},it={class:"flex items-center mb-2"},ct={class:"ml-2"},dt={class:"flex items-center"},vt={class:"ml-2"},mt={key:0,class:"flex items-center justify-between space-x-2 mt-4"},ft={key:1,class:"text-ink-gray-5"},gt={__name:"UpcomingEvaluations",props:{batch:{type:String,default:null},courses:{type:Array,default:[]},endDate:{type:String,default:null},forHome:{type:Boolean,default:!1}},setup(a){const f=Y("$dayjs"),i=S(!1),v=Me(),{$dialog:c}=v.appContext.config.globalProperties,s=a,e=Z({url:"lms.lms.utils.get_upcoming_evals",params:{courses:s.courses.map(l=>l.course),batch:s.batch},auto:!0});function p(){i.value=!0}const d=l=>{window.open(l.google_meet_link,"_blank")},x=$(()=>s.courses.filter(l=>l.evaluator!="")),r=l=>{c({title:__("Cancel this evaluation?"),message:__("Are you sure you want to cancel this evaluation? This action cannot be undone."),actions:[{label:__("Cancel"),theme:"red",variant:"solid",onClick(t){te("lms.lms.api.cancel_evaluation",{evaluation:l}).then(()=>{e.reload()}),t()}}]})};return(l,t)=>{var n,o,b;return y(),w(F,null,[!a.forHome||a.forHome&&((n=u(e).data)!=null&&n.length)?(y(),w("div",et,[h("div",tt,[h("div",at,M(l.__("Upcoming Evaluations")),1),((o=u(e).data)==null?void 0:o.length)!=x.value.length&&!a.forHome?(y(),O(u(N),{key:0,onClick:p},{default:D(()=>[j(M(l.__("Schedule Evaluation")),1)]),_:1})):P("",!0)]),(b=u(e).data)!=null&&b.length?(y(),w("div",lt,[h("div",{class:ee(["grid gap-4",a.forHome?"grid-cols-1 md:grid-cols-2":"grid-cols-3"])},[(y(!0),w(F,null,L(u(e).data,m=>(y(),w("div",null,[h("div",st,[h("div",nt,[h("span",ot,M(m.course_title),1),m.date>u(f)().format()?(y(),O(u(je),{key:0,as:"div",class:"relative inline-block text-left"},{default:D(()=>[h("div",null,[I(u(Ne),{class:"inline-flex w-full justify-center"},{default:D(()=>[I(u(Se),{class:"w-4 h-4 stroke-1.5"})]),_:1})]),I(we,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:D(()=>[I(u(Oe),{class:"absolute mt-2 w-32 rounded-md bg-surface-white border p-1.5"},{default:D(()=>[I(u(Le),null,{default:D(({active:g})=>[I(u(N),{variant:"ghost",class:"w-full",onClick:E=>r(m)},{prefix:D(()=>[I(u(Ce),{active:g,class:"size-4 stroke-1.5","aria-hidden":"true"},null,8,["active"])]),default:D(()=>[j(" "+M(l.__("Cancel")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):P("",!0)]),h("div",rt,[I(u(X),{class:"w-4 h-4 stroke-1.5"}),h("span",ut,M(u(f)(m.date).format("DD MMMM YYYY")),1)]),h("div",it,[I(u(De),{class:"w-4 h-4 stroke-1.5"}),h("span",ct,M(u(U)(m.start_time)),1)]),h("div",dt,[I(u($e),{class:"w-4 h-4 stroke-1.5"}),h("span",vt,M(m.evaluator_name),1)]),m.google_meet_link?(y(),w("div",mt,[I(u(N),{onClick:g=>d(m),class:"w-full"},{prefix:D(()=>[I(u(Re),{class:"w-4 h-4 stroke-1.5"})]),default:D(()=>[j(" "+M(l.__("Join Call")),1)]),_:1},8,["onClick"])])):P("",!0)])]))),256))],2)])):(y(),w("div",ft,M(l.__("Schedule an evaluation to get certified.")),1))])):P("",!0),I(Xe,{batch:a.batch,endDate:a.endDate,courses:a.courses,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=m=>i.value=m),reloadEvals:u(e),"onUpdate:reloadEvals":t[1]||(t[1]=m=>Ee(e)?e.value=m:null)},null,8,["batch","endDate","courses","modelValue","reloadEvals"])],64)}}};export{gt as _};
//# sourceMappingURL=UpcomingEvaluations-Cdag8zuj.js.map
