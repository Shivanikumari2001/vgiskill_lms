import{y as i,x as Z,z as ee,H as te,i as $,A as L,J as ae,B as F,E as le,a as h,e as m,f as d,h as C,b as w,u as l,K as se,w as _,l as N,t as x,L as oe,n as re,P as ne,p as U,N as k,O as ue,Q as P,R as ie,F as M,g as de,r as ce,o as p}from"./index-C4szjxrb.js";import{_ as pe}from"./CourseCard-TffUk2Yf.js";import{_ as me}from"./EmptyState.vue_vue_type_script_setup_true_lang-BylHWie9.js";import{_ as ve}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";import{T as fe}from"./TabButtons-1rgcL6JH.js";import"./CourseInstructors-B3F68-l4.js";import"./UserAvatar-Dm5-Kddr.js";const ge={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},_e={class:"p-5 pb-10"},be={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},ye={class:"text-lg text-ink-gray-9 font-semibold"},he={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},Ce={class:"grid grid-cols-2 gap-2"},we={class:"w-full lg:min-w-0 lg:w-32 xl:w-40"},xe={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 2xl:grid-cols-4 gap-8"},ke={key:2,class:"flex justify-center mt-5"},Me={__name:"Courses",setup(Se){var V;const n=$("$user"),T=$("$dayjs"),j=i(0),D=i(30),v=i([]),f=i(null),g=i(""),b=i(!1),a=i({}),u=i("Live"),{brand:E}=Z(),S=i(0);ee(()=>{B(),y(),z(),v.value=[{label:"",value:null}]});const B=()=>{let e=new URLSearchParams(location.search);g.value=e.get("title")||"",f.value=e.get("category")||null,b.value=e.get("certification")||!1},c=te({doctype:"LMS Course",url:"lms.lms.utils.get_courses",cache:["courses",(V=n.data)==null?void 0:V.name],pageLength:D.value,start:j.value,onSuccess(e){R(e)}}),R=e=>{let t=e.map(o=>o.category);t=t.filter((o,r)=>t.indexOf(o)===r&&o),v.value.length<=t.length&&G(e)},Y=async()=>await L("frappe.client.get_single_value",{doctype:"LMS Settings",field:"persona_captured"}),q=async()=>{var e,t;if((e=n.data)!=null&&e.is_system_manager&&!((t=n.data)!=null&&t.developer_mode)){if(await Y())return;S.value||k.push({name:"PersonaForm"})}},z=()=>{n.data&&L("frappe.client.get_count",{doctype:"LMS Course"}).then(e=>{S.value=e,q()})},y=()=>{I(),c.update({filters:a.value}),c.reload()},I=()=>{O(),Q(),A(),K(),H(),J()},O=()=>{f.value?a.value.category=f.value:delete a.value.category},Q=()=>{g.value?a.value.title=["like",`%${g.value}%`]:delete a.value.title},A=()=>{b.value?a.value.certification=1:delete a.value.certification},K=()=>{var e;delete a.value.live,delete a.value.created,delete a.value.published_on,delete a.value.upcoming,u.value=="Enrolled"&&((e=n.data)!=null&&e.is_student)?(a.value.enrolled=1,delete a.value.published):(delete a.value.published,delete a.value.enrolled,u.value=="Live"?(a.value.published=1,a.value.upcoming=0,a.value.live=1):u.value=="Upcoming"?a.value.upcoming=1:u.value=="New"?(a.value.published=1,a.value.published_on=[">=",T().add(-3,"month").format("YYYY-MM-DD")]):u.value=="Created"?a.value.created=1:u.value=="Unpublished"&&(a.value.published=0))},H=()=>{var e;(!n.data||(e=n.data)!=null&&e.is_student&&u.value!="Enrolled")&&(a.value.published=1)},J=()=>{let e=new URLSearchParams(location.search),t={title:g.value,category:f.value,certification:b.value};Object.keys(t).forEach(r=>{t[r]?e.set(r,t[r]):e.delete(r)});let o="";e.toString()&&(o=`?${e.toString()}`),history.replaceState({},"",`${location.pathname}${o}`)},G=e=>{e.forEach(t=>{t.category&&!v.value.find(o=>o.value===t.category)&&v.value.push({label:t.category,value:t.category})})};ae(u,()=>{y()});const W=F(()=>{var t,o,r;let e=[{label:__("Live")},{label:__("New")},{label:__("Upcoming")}];return(t=n.data)!=null&&t.is_moderator||(o=n.data)!=null&&o.is_instructor||(r=n.data)!=null&&r.is_evaluator?(e.push({label:__("Created")}),e.push({label:__("Unpublished")})):n.data&&e.push({label:__("Enrolled")}),e}),X=F(()=>[{label:__("Courses"),route:{name:"Courses"}}]);return le(()=>({title:__("Courses"),icon:E.favicon})),(e,t)=>{var r;const o=ce("router-link");return p(),h(M,null,[m("header",ge,[d(l(ve),{items:X.value},null,8,["items"]),l(se)()?(p(),C(l(ue),{key:0,placement:"start",side:"bottom",options:[{label:e.__("New Course"),icon:"book-open",onClick(){l(k).push({name:"CourseForm",params:{courseName:"new"}})}},{label:e.__("Import Course"),icon:"upload",onClick(){l(k).push({name:"NewDataImport",params:{doctype:"LMS Course"}})}}]},{default:_(({open:s})=>[d(l(U),{variant:"solid"},{prefix:_(()=>[d(l(ne),{class:"h-4 w-4 stroke-1.5"})]),suffix:_(()=>[d(l(oe),{class:re(["w-4 h-4 stroke-1.5 ml-1 transform transition-transform",s?"rotate-180":""])},null,8,["class"])]),default:_(()=>[N(" "+x(e.__("Create"))+" ",1)]),_:2},1024)]),_:1},8,["options"])):w("",!0)]),m("div",_e,[m("div",be,[m("div",ye,x(e.__("All Courses")),1),m("div",he,[d(l(fe),{buttons:W.value,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),class:"w-fit"},null,8,["buttons","modelValue"]),m("div",Ce,[d(l(P),{modelValue:g.value,"onUpdate:modelValue":t[1]||(t[1]=s=>g.value=s),placeholder:e.__("Search by Title"),type:"text",class:"w-full lg:min-w-0 lg:w-32 xl:w-40",onInput:t[2]||(t[2]=s=>y())},null,8,["modelValue","placeholder"]),m("div",we,[v.value.length?(p(),C(l(ie),{key:0,modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=s=>f.value=s),t[4]||(t[4]=s=>y())],options:v.value,placeholder:e.__("Category")},null,8,["modelValue","options","placeholder"])):w("",!0)])]),d(l(P),{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=s=>b.value=s),label:e.__("Certification"),type:"checkbox",onChange:t[6]||(t[6]=s=>y())},null,8,["modelValue","label"])])]),(r=l(c).data)!=null&&r.length?(p(),h("div",xe,[(p(!0),h(M,null,de(l(c).data,s=>(p(),C(o,{to:{name:"CourseDetail",params:{courseName:s.name}}},{default:_(()=>[d(pe,{course:s},null,8,["course"])]),_:2},1032,["to"]))),256))])):l(c).list.loading?w("",!0):(p(),C(me,{key:1,type:"Courses"})),!l(c).list.loading&&l(c).hasNextPage?(p(),h("div",ke,[d(l(U),{onClick:t[7]||(t[7]=s=>l(c).next())},{default:_(()=>[N(x(e.__("Load More")),1)]),_:1})])):w("",!0)])],64)}}};export{Me as default};
//# sourceMappingURL=Courses-9RNYZ0Hh.js.map
