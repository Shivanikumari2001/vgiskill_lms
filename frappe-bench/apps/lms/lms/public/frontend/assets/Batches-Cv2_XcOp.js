import{x as W,y as n,B as V,i as D,z as X,H as Z,J as ee,E as te,a as k,e as p,f as c,h as w,b as B,u as s,w as g,l as F,t as $,L as ae,n as le,P as se,p as S,q as oe,O as re,Q as U,R as ne,F as L,g as ie,r as ue,o as i}from"./index-C4szjxrb.js";import{_ as de}from"./BatchCard-MrVAqj3J.js";import{_ as ce}from"./EmptyState.vue_vue_type_script_setup_true_lang-BylHWie9.js";import{_ as me}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";import{T as pe}from"./TabButtons-1rgcL6JH.js";import"./DateRange-DznmYu92.js";import"./CourseInstructors-B3F68-l4.js";import"./UserAvatar-Dm5-Kddr.js";const ve={class:"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5"},fe={class:"p-5 pb-10"},_e={class:"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5"},ge={class:"text-lg text-ink-gray-9 font-semibold"},he={class:"flex flex-col space-y-3 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-4"},be={class:"grid grid-cols-2 gap-2"},ye={class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40"},we={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"},Be={key:2,class:"flex justify-center mt-5"},Se={__name:"Batches",setup(xe){var Y;const r=D("$user"),C=D("$dayjs"),{brand:N}=W(),T=n(0),j=n(20),v=n([]),f=n(null),_=n(""),h=n(!1),a=n({}),x=V(()=>{var t;return(t=r.data)==null?void 0:t.is_student}),u=n(x.value?"All":"Upcoming"),b=n("start_date"),E=window.read_only_mode,M=oe();X(()=>{P(),y(),v.value=[{label:"",value:null}]});const P=()=>{let t=new URLSearchParams(location.search);_.value=t.get("title")||"",f.value=t.get("category")||null,h.value=t.get("certification")||!1},d=Z({doctype:"LMS Batch",url:"lms.lms.utils.get_batches",cache:["batches",(Y=r.data)==null?void 0:Y.name],pageLength:j.value,start:T.value,onSuccess(t){let e=t.map(l=>l.category);e=e.filter((l,m)=>e.indexOf(l)===m&&l),v.value.length<=e.length&&H(t)}}),y=()=>{A(),d.update({filters:a.value,orderBy:b.value}),d.reload()},A=()=>{R(),z(),O(),q(),I(),Q()},R=()=>{f.value?a.value.category=f.value:delete a.value.category},z=()=>{_.value?a.value.title=["like",`%${_.value}%`]:delete a.value.title},O=()=>{h.value?a.value.certification=1:delete a.value.certification},q=()=>{b.value="start_date",r.data&&(u.value=="Enrolled"&&x.value?(a.value.enrolled=1,delete a.value.start_date,delete a.value.published,b.value="start_date desc"):x.value?delete a.value.enrolled:(delete a.value.start_date,delete a.value.published,b.value="start_date desc",u.value=="Upcoming"?(a.value.start_date=[">=",C().format("YYYY-MM-DD")],a.value.published=1,b.value="start_date"):u.value=="Archived"?a.value.start_date=["<=",C().format("YYYY-MM-DD")]:u.value=="Unpublished"&&(a.value.published=0)))},I=()=>{(!r.data||x.value&&u.value!="Enrolled")&&(a.value.start_date=[">=",C().format("YYYY-MM-DD")],a.value.published=1)},Q=()=>{let t=new URLSearchParams(location.search),e={title:_.value,category:f.value,certification:h.value};Object.keys(e).forEach(l=>{e[l]?t.set(l,e[l]):t.delete(l)}),history.replaceState({},"",`${location.pathname}${t.size>0?`?${t.toString()}`:""}`)},H=t=>{t.forEach(e=>{e.category&&!v.value.find(l=>l.value===e.category)&&v.value.push({label:e.category,value:e.category})})};ee(u,()=>{y()});const J=V(()=>{var e,l,m;let t=[{label:__("All")}];return(e=r.data)!=null&&e.is_moderator||(l=r.data)!=null&&l.is_instructor||(m=r.data)!=null&&m.is_evaluator?(t.push({label:__("Upcoming")}),t.push({label:__("Archived")}),t.push({label:__("Unpublished")})):r.data&&t.push({label:__("Enrolled")}),t}),K=()=>{var t,e,l;return E?!1:!!((t=r.data)!=null&&t.is_moderator||(e=r.data)!=null&&e.is_instructor||(l=r.data)!=null&&l.is_evaluator)},G=V(()=>[{label:__("Batches"),route:{name:"Batches"}}]);return te(()=>({title:__("Batches"),icon:N.favicon})),(t,e)=>{var m;const l=ue("router-link");return i(),k(L,null,[p("header",ve,[c(s(me),{items:G.value},null,8,["items"]),K()?(i(),w(s(re),{key:0,options:[{label:t.__("New Batch"),icon:"users",onClick(){s(M).push({name:"BatchForm",params:{batchName:"new"}})}},{label:t.__("Import Batch"),icon:"upload",onClick(){s(M).push({name:"NewDataImport",params:{doctype:"LMS Batch"}})}}]},{default:g(({open:o})=>[c(s(S),{variant:"solid"},{prefix:g(()=>[c(s(se),{class:"h-4 w-4 stroke-1.5"})]),suffix:g(()=>[c(s(ae),{class:le(["w-4 h-4 stroke-1.5 ml-1 transform transition-transform",o?"rotate-180":""])},null,8,["class"])]),default:g(()=>[F(" "+$(t.__("Create"))+" ",1)]),_:2},1024)]),_:1},8,["options"])):B("",!0)]),p("div",fe,[p("div",_e,[p("div",ge,$(t.__("All Batches")),1),p("div",he,[s(r).data?(i(),w(s(pe),{key:0,buttons:J.value,modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),class:"w-fit"},null,8,["buttons","modelValue"])):B("",!0),p("div",be,[c(s(U),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=o=>_.value=o),placeholder:t.__("Search by Title"),type:"text",class:"min-w-40 lg:min-w-0 lg:w-32 xl:w-40",onInput:e[2]||(e[2]=o=>y())},null,8,["modelValue","placeholder"]),p("div",ye,[v.value.length?(i(),w(s(ne),{key:0,modelValue:f.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>f.value=o),e[4]||(e[4]=o=>y())],options:v.value,placeholder:t.__("Category")},null,8,["modelValue","options","placeholder"])):B("",!0)])]),c(s(U),{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),label:t.__("Certification"),type:"checkbox",onChange:e[6]||(e[6]=o=>y())},null,8,["modelValue","label"])])]),(m=s(d).data)!=null&&m.length?(i(),k("div",we,[(i(!0),k(L,null,ie(s(d).data,o=>(i(),w(l,{to:{name:"BatchDetail",params:{batchName:o.name}}},{default:g(()=>[c(de,{batch:o},null,8,["batch"])]),_:2},1032,["to"]))),256))])):s(d).list.loading?B("",!0):(i(),w(ce,{key:1,type:"Batches"})),!s(d).list.loading&&s(d).hasNextPage?(i(),k("div",Be,[c(s(S),{onClick:e[7]||(e[7]=o=>s(d).next())},{default:g(()=>[F($(t.__("Load More")),1)]),_:1})])):B("",!0)])],64)}}};export{Se as default};
//# sourceMappingURL=Batches-Cv2_XcOp.js.map
