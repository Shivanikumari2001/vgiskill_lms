import{d as pe,B as J,a as k,e as a,f as r,t as n,u as t,bL as _e,w as f,F as Q,g as X,am as R,a0 as B,Q as d,p as E,bD as Y,h,b as y,cx as fe,o as u,y as T,x as ge,aN as be,aV as ve,ac as j,z as ye,i as Ce,q as Ve,ab as K,c as $,cy as he,ar as ke,aa as N,cz as G,J as we,E as xe,ao as Ue,aK as z,n as Se,bC as $e,l as M,cA as Ne,cB as Ee,bE as Me,aj as Pe,bG as Te,cC as ze,aO as L}from"./index-C4szjxrb.js";import{_ as Le}from"./CourseOutline-CFCV-q58.js";import{_ as H}from"./MultiSelect-Crx778mX.js";import{_ as Fe}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";import"./vuedraggable.umd-DFZ6PtG-.js";import"./use-resolve-button-type-WYY12HT4.js";const qe={class:"text-xs text-ink-gray-5 mb-1"},Ie={class:"space-y-2"},Oe={class:"rounded-lg bg-surface-white p-3 border w-fit mt-2"},De={class:"text-xs text-ink-gray-5 mb-1.5"},Ae={class:"grid grid-cols-7 gap-2"},Re=["onClick"],Be={class:"text-sm text-ink-gray-5 mt-2"},je=pe({__name:"ColorSwatches",props:{modelValue:{},label:{},description:{}},emits:["update:modelValue","change"],setup(C,{emit:V}){const c=V,P=J(()=>["Red","Blue","Green","Amber","Purple","Cyan","Orange","Violet","Pink","Teal","Gray","Yellow"]);return(g,m)=>(u(),k("div",null,[a("div",qe,n(g.__(C.label)),1),r(t(_e),{placement:"bottom",class:"!block"},{target:f(({togglePopover:_,isOpen:w})=>[a("div",Ie,[r(t(d),{type:"text",autocomplete:"off",class:"w-full",placeholder:g.__("Set Color"),onFocus:_,modelValue:C.modelValue,"onUpdate:modelValue":m[1]||(m[1]=U=>c("update:modelValue",U))},{prefix:f(()=>[a("div",{class:"size-4 rounded-full",style:R(C.modelValue?{backgroundColor:t(B)(C.modelValue.toLowerCase(),400)}:{})},[C.modelValue?y("",!0):(u(),h(t(fe),{key:0,class:"size-4 stroke-1.5 text-ink-gray-5"}))],4)]),suffix:f(()=>[r(t(E),{variant:"ghost"},{default:f(()=>[r(t(Y),{class:"size-3 text-ink-gray-5",onClick:m[0]||(m[0]=U=>c("update:modelValue",null))})]),_:1})]),_:1},8,["placeholder","onFocus","modelValue"])])]),body:f(({close:_})=>[a("div",Oe,[a("div",De,n(g.__("Swatches")),1),a("div",Ae,[(u(!0),k(Q,null,X(P.value,w=>(u(),k("div",{key:w,class:"size-5 rounded-full cursor-pointer",style:R({backgroundColor:t(B)(w.toLowerCase(),400)}),onClick:U=>{c("update:modelValue",w),_(),c("change",w)}},null,12,Re))),128))])])]),_:1}),a("div",Be,n(C.description),1)]))}}),Ke={class:"h-full"},Ge={class:"grid grid-cols-1 md:grid-cols-[70%,30%] h-full"},He={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Je={class:"flex items-center mt-3 md:mt-0"},Qe={class:"mt-5 mb-5"},Xe={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},Ye={class:"text-lg font-semibold mb-4 text-ink-gray-9"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},Ze={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},es={class:"text-xs text-ink-gray-5"},ss={class:"flex items-center flex-wrap gap-2"},ls={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md"},os={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},as={class:"mb-4"},ts={class:"text-xs text-ink-gray-5 mb-2"},rs={class:"flex items-center"},is=["onClick"],ds={class:"ml-4"},ns={class:"mt-1 text-ink-gray-5 text-sm leading-5"},us={key:1,class:"mb-4"},cs={class:"flex items-center"},ms=["src"],ps={class:"ml-4"},_s={class:"mt-2 text-ink-gray-5 text-sm"},fs={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},gs={class:"text-lg font-semibold text-ink-gray-9"},bs={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},vs={key:0,class:"flex flex-col space-y-5"},ys={class:"flex flex-col space-y-5"},Cs={class:"px-5 md:px-10 pb-5 mb-5 space-y-5 border-b"},Vs={class:"text-lg font-semibold text-ink-gray-9"},hs={class:""},ks={class:"mb-1.5 text-sm text-ink-gray-5"},ws={class:"px-5 md:px-10 pb-5 space-y-5 border-b"},xs={class:"text-lg font-semibold mt-5 text-ink-gray-9"},Us={class:"grid grid-cols-1 md:grid-cols-3 gap-5"},Ss={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},$s={class:"space-y-5"},Ns={class:"space-y-5"},Es={class:"px-5 md:px-10 pb-5 space-y-5"},Ms={class:"text-lg font-semibold mt-5 text-ink-gray-9"},Ps={class:"space-y-5"},Ts={class:"border-l"},As={__name:"CourseForm",props:{courseName:{type:String}},setup(C){const V=Ce("$user"),c=T(""),{brand:P}=ge(),g=Ve(),m=T([]),_=T([]),w=ve(),{updateOnboardingStep:U}=be("learning"),{$dialog:W}=w.appContext.config.globalProperties,b=C,l=j({title:"",short_introduction:"",description:"",video_link:"",course_image:null,card_gradient:"",tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,paid_certificate:!1,course_price:"",currency:"",evaluator:"",timezone:""}),x=j({description:"",keywords:""});ye(()=>{var e,s;!((e=V.data)!=null&&e.is_moderator)&&!((s=V.data)!=null&&s.is_instructor)&&g.push({name:"Courses"}),b.courseName!=="new"?F():K("course_form_opened"),window.addEventListener("keydown",q)});const F=()=>{v.reload(),he("courses",b.courseName,x)},q=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(I(),e.preventDefault())};ke(()=>{window.removeEventListener("keydown",q)});const Z=$({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"LMS Course",image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:m.value.map(i=>({instructor:i})),related_courses:_.value.map(i=>({course:i})),...e}}}}),ee=$({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:{image:((s=l.course_image)==null?void 0:s.file_url)||"",instructors:m.value.map(i=>({instructor:i})),related_courses:_.value.map(i=>({course:i})),...l}}}}),v=$({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:b.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(i=>{i=="instructors"?(m.value=[],e.instructors.forEach(p=>{m.value.push(p.instructor)})):i=="related_courses"?(_.value=[],e.related_courses.forEach(p=>{_.value.push(p.course)})):Object.hasOwn(l,i)&&(l[i]=e[i])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification","paid_certificate"];for(let i in s){let p=s[i];l[p]=!!l[p]}e.image&&se.reload({image:e.image}),ce()}}),se=$({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.course_image=e}}),le=()=>{l.description=Te(l.description),Object.keys(l).forEach(e=>{e!="description"&&typeof l[e]=="string"&&(l[e]=ze(l[e]))})},I=()=>{le(),v.data?ae():oe()},oe=()=>{Z.submit(l,{onSuccess(e){var s;G("courses",e.name,x),(s=V.data)!=null&&s.is_system_manager&&U("create_first_course",!0,!1,()=>{localStorage.setItem("firstCourse",e.name)}),K("course_created"),N.success(__("Course created successfully")),g.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;N.error(((s=e.messages)==null?void 0:s[0])||e)}})},ae=()=>{ee.submit({course:v.data.name},{onSuccess(){G("courses",b.courseName,x),N.success(__("Course updated successfully"))},onError(e){var s;N.error(((s=e.messages)==null?void 0:s[0])||e)}})},te=$({url:"lms.lms.api.delete_course",makeParams(e){return{course:b.courseName}},onSuccess(){N.success(__("Course deleted successfully")),g.push({name:"Courses"})}}),re=()=>{W({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){te.submit(),e()}}]})};we(()=>b.courseName!=="new",e=>{e&&F()});const ie=()=>{c.value&&(l.tags=l.tags?`${l.tags}, ${c.value}`:c.value,c.value="")},de=e=>{var s;l.tags=(s=l.tags)==null?void 0:s.split(", ").filter(i=>i!==e).join(", "),c.value=""},ne=e=>{l.course_image=e},ue=()=>{l.course_image=null},ce=()=>{var s;let e=!1;(s=V.data)!=null&&s.is_moderator||(m.value.forEach(i=>{var p;!e&&i==((p=V.data)==null?void 0:p.name)&&(e=!0)}),e||g.push({name:"Courses"}))},me=J(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return v.data&&e.push({label:l.title,route:{name:"CourseDetail",params:{courseName:b.courseName}}}),e.push({label:b.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:b.courseName}}}),e});return xe(()=>{var e;return{title:((e=v.data)==null?void 0:e.title)||__("New Course"),icon:P.favicon}}),(e,s)=>{var i,p,O,D;return u(),k("div",Ke,[a("div",Ge,[a("div",null,[a("header",He,[r(t(Fe),{class:"h-7",items:me.value},null,8,["items"]),a("div",Je,[(i=t(v).data)!=null&&i.name?(u(),h(t(E),{key:0,onClick:s[0]||(s[0]=o=>re())},{icon:f(()=>[r(t(Ue),{class:"w-4 h-4 stroke-1.5"})]),_:1})):y("",!0),r(t(E),{variant:"solid",onClick:s[1]||(s[1]=o=>I()),class:"ml-2"},{default:f(()=>[a("span",null,n(e.__("Save")),1)]),_:1})])]),a("div",Qe,[a("div",Xe,[a("div",Ye,n(e.__("Details")),1),a("div",We,[r(t(d),{modelValue:l.title,"onUpdate:modelValue":s[2]||(s[2]=o=>l.title=o),label:e.__("Title"),required:!0},null,8,["modelValue","label"]),r(z,{doctype:"LMS Category",modelValue:l.category,"onUpdate:modelValue":s[3]||(s[3]=o=>l.category=o),label:e.__("Category"),onCreate:(o,S)=>t(L)("Categories",S)},null,8,["modelValue","label","onCreate"])]),a("div",Ze,[r(H,{modelValue:m.value,"onUpdate:modelValue":s[4]||(s[4]=o=>m.value=o),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},onCreate:o=>t(L)("Members",o),required:!0},null,8,["modelValue","label","onCreate"]),a("div",null,[a("div",es,n(e.__("Tags")),1),r(t(d),{modelValue:c.value,"onUpdate:modelValue":s[5]||(s[5]=o=>c.value=o),placeholder:e.__("Add a keyword and then press enter"),class:Se(["w-full","flex-1","my-1"]),onKeyup:s[6]||(s[6]=$e(o=>ie(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"]),a("div",null,[a("div",ss,[l.tags?(u(!0),k(Q,{key:0},X((p=l.tags)==null?void 0:p.split(", "),o=>(u(),k("div",ls,[M(n(o)+" ",1),r(t(Y),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:S=>de(o)},null,8,["onClick"])]))),256)):y("",!0)])])])]),a("div",os,[a("div",as,[a("div",ts,n(e.__("Course Image")),1),l.course_image?(u(),k("div",us,[a("div",cs,[a("img",{src:l.course_image.file_url,class:"border rounded-md w-40"},null,8,ms),a("div",ps,[r(t(E),{onClick:s[8]||(s[8]=o=>ue())},{default:f(()=>[M(n(e.__("Remove")),1)]),_:1}),a("div",_s,n(e.__("Appears on the course card in the course list")),1)])])])):(u(),h(t(Me),{key:0,fileTypes:["image/*"],validateFile:t(Ee),onSuccess:s[7]||(s[7]=o=>ne(o))},{default:f(({file:o,progress:S,uploading:zs,openFileSelector:A})=>[a("div",rs,[a("div",{class:"border rounded-md w-fit py-5 px-20 cursor-pointer",onClick:A},[r(t(Ne),{class:"size-5 stroke-1 text-ink-gray-7"})],8,is),a("div",ds,[r(t(E),{onClick:A},{default:f(()=>[M(n(e.__("Upload")),1)]),_:1},8,["onClick"]),a("div",ns,n(e.__("Appears on the course card in the course list")),1)])])]),_:1},8,["validateFile"]))]),r(je,{modelValue:l.card_gradient,"onUpdate:modelValue":s[9]||(s[9]=o=>l.card_gradient=o),label:e.__("Color"),description:e.__("Choose a color for the course card"),class:"w-full"},null,8,["modelValue","label","description"])])]),a("div",fs,[a("div",gs,n(e.__("Settings")),1),a("div",bs,[(O=t(V).data)!=null&&O.is_moderator?(u(),k("div",vs,[r(t(d),{type:"checkbox",modelValue:l.published,"onUpdate:modelValue":s[10]||(s[10]=o=>l.published=o),label:e.__("Published")},null,8,["modelValue","label"]),r(t(d),{modelValue:l.published_on,"onUpdate:modelValue":s[11]||(s[11]=o=>l.published_on=o),label:e.__("Published On"),type:"date"},null,8,["modelValue","label"])])):y("",!0),a("div",ys,[r(t(d),{type:"checkbox",modelValue:l.upcoming,"onUpdate:modelValue":s[12]||(s[12]=o=>l.upcoming=o),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.featured,"onUpdate:modelValue":s[13]||(s[13]=o=>l.featured=o),label:e.__("Featured")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.disable_self_learning,"onUpdate:modelValue":s[14]||(s[14]=o=>l.disable_self_learning=o),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"])])])]),a("div",Cs,[a("div",Vs,n(e.__("About the Course")),1),r(t(d),{modelValue:l.short_introduction,"onUpdate:modelValue":s[15]||(s[15]=o=>l.short_introduction=o),type:"textarea",rows:5,label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),required:!0},null,8,["modelValue","label","placeholder"]),a("div",hs,[a("div",ks,[M(n(e.__("Course Description"))+" ",1),s[28]||(s[28]=a("span",{class:"text-ink-red-3"},"*",-1))]),r(t(Pe),{content:l.description,onChange:s[16]||(s[16]=o=>l.description=o),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),r(t(d),{modelValue:l.video_link,"onUpdate:modelValue":s[17]||(s[17]=o=>l.video_link=o),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course")},null,8,["modelValue","label","placeholder"]),r(H,{modelValue:_.value,"onUpdate:modelValue":s[18]||(s[18]=o=>_.value=o),doctype:"LMS Course",label:e.__("Related Courses"),filters:{name:["!=",(D=t(v).data)==null?void 0:D.name]},onCreate:o=>{t(g).push({name:"CourseForm",params:{courseName:"new"}})}},null,8,["modelValue","label","filters","onCreate"])]),a("div",ws,[a("div",xs,n(e.__("Pricing and Certification")),1),a("div",Us,[r(t(d),{type:"checkbox",modelValue:l.paid_course,"onUpdate:modelValue":s[19]||(s[19]=o=>l.paid_course=o),label:e.__("Paid Course")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.enable_certification,"onUpdate:modelValue":s[20]||(s[20]=o=>l.enable_certification=o),label:e.__("Completion Certificate")},null,8,["modelValue","label"]),r(t(d),{type:"checkbox",modelValue:l.paid_certificate,"onUpdate:modelValue":s[21]||(s[21]=o=>l.paid_certificate=o),label:e.__("Paid Certificate")},null,8,["modelValue","label"])]),a("div",Ss,[a("div",$s,[l.paid_course||l.paid_certificate?(u(),h(t(d),{key:0,modelValue:l.course_price,"onUpdate:modelValue":s[22]||(s[22]=o=>l.course_price=o),label:e.__("Amount"),required:l.paid_course||l.paid_certificate},null,8,["modelValue","label","required"])):y("",!0),l.paid_certificate?(u(),h(z,{key:1,doctype:"Course Evaluator",modelValue:l.evaluator,"onUpdate:modelValue":s[23]||(s[23]=o=>l.evaluator=o),label:e.__("Evaluator"),required:l.paid_certificate,onCreate:(o,S)=>t(L)("Evaluators",S)},null,8,["modelValue","label","required","onCreate"])):y("",!0)]),a("div",Ns,[l.paid_course||l.paid_certificate?(u(),h(z,{key:0,doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":s[24]||(s[24]=o=>l.currency=o),filters:{enabled:1},label:e.__("Currency"),required:l.paid_course||l.paid_certificate},null,8,["modelValue","label","required"])):y("",!0),l.paid_certificate?(u(),h(t(d),{key:1,modelValue:l.timezone,"onUpdate:modelValue":s[25]||(s[25]=o=>l.timezone=o),label:e.__("Timezone"),required:l.paid_certificate,placeholder:e.__("e.g. IST, UTC, GMT...")},null,8,["modelValue","label","required","placeholder"])):y("",!0)])])]),a("div",Es,[a("div",Ms,n(e.__("Meta Tags")),1),a("div",Ps,[r(t(d),{modelValue:x.description,"onUpdate:modelValue":s[26]||(s[26]=o=>x.description=o),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),r(t(d),{modelValue:x.keywords,"onUpdate:modelValue":s[27]||(s[27]=o=>x.keywords=o),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])]),a("div",Ts,[t(v).data?(u(),h(Le,{key:0,courseName:t(v).data.name,title:e.__("Course Outline"),allowEdit:!0},null,8,["courseName","title"])):y("",!0)])])])}}};export{As as default};
//# sourceMappingURL=CourseForm-OmfXpiYP.js.map
