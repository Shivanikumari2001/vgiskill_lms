import{x as Y,aN as ee,y as ae,aV as te,ac as N,z as le,i as se,ab as E,c as f,cy as oe,ar as ie,aa as w,cz as M,q as ne,B as de,E as re,a as B,e as s,f as i,u as o,h as D,b as T,w as _,ao as me,p as g,l as y,t as r,Q as n,aj as ue,aK as v,cA as ce,cB as pe,bE as be,bG as z,cC as _e,o as h,aO as V,A as he}from"./index-C4szjxrb.js";import{_ as fe}from"./MultiSelect-Crx778mX.js";import{_ as ge}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";const ye={class:""},ve={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ve={class:"flex items-center space-x-2"},ke={class:"py-5"},we={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Be={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ce={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},xe={class:"space-y-5"},Se={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Ue={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Ne={class:"grid grid-cols-1 md:grid-cols-3 gap-5"},Ee={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},Me={class:"text-lg text-ink-gray-9 font-semibold mb-4"},De={class:"grid grid-cols-1 md:grid-cols-3 gap-10"},Te={class:"space-y-5"},ze={class:"space-y-5"},Le={class:"space-y-5"},Oe={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},$e={class:"block text-sm text-ink-gray-5 mb-1"},Ie={class:"px-5 md:px-20 pb-5 space-y-5 border-b mb-5"},qe={class:"text-lg text-ink-gray-9 font-semibold mb-4"},Pe={class:"grid grid-cols-1 md:grid-cols-3 gap-10"},Ae={class:"space-y-5"},je={class:"space-y-5"},Fe={class:"space-y-5"},Re={class:"text-xs text-ink-gray-5"},Ke={class:"flex items-center"},Ze=["onClick"],He={class:"ml-4"},Ge={class:"mt-1 text-ink-gray-5 text-sm leading-5"},Qe={key:1,class:"mb-4"},Je={class:"flex items-center"},We=["src"],Xe={class:"ml-4"},Ye={class:"mt-2 text-ink-gray-5 text-sm"},ea={class:"px-5 md:px-20 pb-5 space-y-5"},aa={class:"text-lg text-ink-gray-9 font-semibold"},ta={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-5"},la={class:"px-5 md:px-20 pb-5 space-y-5 border-b"},sa={class:"text-lg text-ink-gray-9 font-semibold"},oa={class:"space-y-5"},ra={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(L){const k=ne(),C=se("$user"),{brand:O}=Y(),{updateOnboardingStep:$}=ee("learning"),b=ae([]),I=te(),{$dialog:q}=I.appContext.config.globalProperties,m=L,l=N({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",confirmation_email_template:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,certification:!1,image:null,paid_batch:!1,currency:"",amount:0,zoom_account:""}),c=N({description:"",keywords:""});le(()=>{C.data||(window.location.href="/login"),m.batchName!="new"?P():E("batch_form_opened"),window.addEventListener("keydown",x)});const P=()=>{p.reload(),oe("batches",m.batchName,c)},x=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(S(),e.preventDefault())};ie(()=>{window.removeEventListener("keydown",x)});const A=f({url:"frappe.client.insert",makeParams(e){var a;return{doc:{doctype:"LMS Batch",meta_image:(a=l.image)==null?void 0:a.file_url,instructors:b.value.map(d=>({instructor:d})),...l}}}}),p=f({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:m.batchName}},onSuccess(e){Object.keys(e).forEach(d=>{if(d=="instructors")e.instructors.forEach(t=>{b.value.push(t.instructor)});else if(["start_time","end_time"].includes(d)){let[t,u,X]=e[d].split(":");t=t.length==1?"0"+t:t,l[d]=`${t}:${u}`}else Object.hasOwn(l,d)&&(l[d]=e[d])});let a=["published","paid_batch","allow_self_enrollment","certification"];for(let d in a){let t=a[d];l[t]=!!l[t]}e.meta_image&&F.reload({image:e.meta_image})}}),j=f({url:"frappe.client.set_value",makeParams(e){var a;return{doctype:"LMS Batch",name:m.batchName,fieldname:{meta_image:(a=l.image)==null?void 0:a.file_url,instructors:b.value.map(d=>({instructor:d})),...l}}}}),F=f({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){l.image=e}}),R=()=>{l.description=z(l.description),l.batch_details=z(l.batch_details),Object.keys(l).forEach(e=>{!["description","batch_details"].includes(e)&&typeof l[e]=="string"&&(l[e]=_e(l[e]))})},S=()=>{R(),p.data?Z():K()},K=()=>{A.submit({},{onSuccess(e){var a;(a=C.data)!=null&&a.is_system_manager&&$("create_first_batch",!0,!1,()=>{localStorage.setItem("firstBatch",e.name)}),M("batches",e.name,c),E("batch_created"),k.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;w.error(((a=e.messages)==null?void 0:a[0])||e)}})},Z=()=>{j.submit({},{onSuccess(e){M("batches",e.name,c),k.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var a;w.error(((a=e.messages)==null?void 0:a[0])||e)}})},H=()=>{q({title:__("Confirm your action to delete"),message:__("Deleting this batch will also delete all its data including enrolled students, linked courses, assessments, feedback and discussions. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick({close:e}){G(e),e()}}]})},G=e=>{he("lms.lms.api.delete_batch",{batch:m.batchName}).then(()=>{w.success(__("Batch deleted successfully")),e(),k.push({name:"Batches"})})},Q=e=>{l.image=e},J=()=>{l.image=null},W=de(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return p.data&&e.push({label:p.data.title,route:{name:"BatchDetail",params:{batchName:m.batchName}}}),e.push({label:m.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:m.batchName}}}),e});return re(()=>{var e;return{title:m.batchName=="new"?"New Batch":(e=p.data)==null?void 0:e.title,icon:O.favicon}}),(e,a)=>{var d;return h(),B("div",ye,[s("header",ve,[i(o(ge),{class:"h-7",items:W.value},null,8,["items"]),s("div",Ve,[(d=o(p).data)!=null&&d.name?(h(),D(o(g),{key:0,onClick:H},{icon:_(()=>[i(o(me),{class:"size-4 stroke-1.5"})]),_:1})):T("",!0),i(o(g),{variant:"solid",onClick:a[0]||(a[0]=t=>S())},{default:_(()=>[y(r(e.__("Save")),1)]),_:1})])]),s("div",ke,[s("div",we,[s("div",Be,r(e.__("Details")),1),s("div",Ce,[s("div",xe,[i(o(n),{modelValue:l.title,"onUpdate:modelValue":a[1]||(a[1]=t=>l.title=t),label:e.__("Title"),required:!0,class:"w-full"},null,8,["modelValue","label"]),i(fe,{modelValue:b.value,"onUpdate:modelValue":a[2]||(a[2]=t=>b.value=t),doctype:"Course Evaluator",label:e.__("Instructors"),required:!0,onCreate:t=>o(V)("Evaluators",t),filters:{ignore_user_type:1}},null,8,["modelValue","label","onCreate"])]),i(o(n),{modelValue:l.description,"onUpdate:modelValue":a[3]||(a[3]=t=>l.description=t),label:e.__("Short Description"),type:"textarea",rows:8,placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"])])]),s("div",Se,[s("div",Ue,r(e.__("Settings")),1),s("div",Ne,[i(o(n),{modelValue:l.published,"onUpdate:modelValue":a[4]||(a[4]=t=>l.published=t),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),i(o(n),{modelValue:l.allow_self_enrollment,"onUpdate:modelValue":a[5]||(a[5]=t=>l.allow_self_enrollment=t),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"]),i(o(n),{modelValue:l.certification,"onUpdate:modelValue":a[6]||(a[6]=t=>l.certification=t),type:"checkbox",label:e.__("Certification")},null,8,["modelValue","label"])])]),s("div",Ee,[s("div",Me,r(e.__("Date and Time")),1),s("div",De,[s("div",Te,[i(o(n),{modelValue:l.start_date,"onUpdate:modelValue":a[7]||(a[7]=t=>l.start_date=t),label:e.__("Batch Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),i(o(n),{modelValue:l.end_date,"onUpdate:modelValue":a[8]||(a[8]=t=>l.end_date=t),label:e.__("Batch End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",ze,[i(o(n),{modelValue:l.start_time,"onUpdate:modelValue":a[9]||(a[9]=t=>l.start_time=t),label:e.__("Session Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),i(o(n),{modelValue:l.end_time,"onUpdate:modelValue":a[10]||(a[10]=t=>l.end_time=t),label:e.__("Session End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",Le,[i(o(n),{modelValue:l.timezone,"onUpdate:modelValue":a[11]||(a[11]=t=>l.timezone=t),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),i(o(n),{modelValue:l.evaluation_end_date,"onUpdate:modelValue":a[12]||(a[12]=t=>l.evaluation_end_date=t),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])])])]),s("div",Oe,[s("div",null,[s("label",$e,[y(r(e.__("Batch Details"))+" ",1),a[26]||(a[26]=s("span",{class:"text-ink-red-3"},"*",-1))]),i(o(ue),{content:l.batch_details,onChange:a[13]||(a[13]=t=>l.batch_details=t),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] max-h-[20rem] overflow-y-scroll mb-4"},null,8,["content"])])]),s("div",Ie,[s("div",qe,r(e.__("Configurations")),1),s("div",Pe,[s("div",Ae,[i(o(n),{modelValue:l.seat_count,"onUpdate:modelValue":a[14]||(a[14]=t=>l.seat_count=t),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),i(v,{doctype:"Email Template",label:e.__("Email Template"),modelValue:l.confirmation_email_template,"onUpdate:modelValue":a[15]||(a[15]=t=>l.confirmation_email_template=t),onCreate:(t,u)=>{o(V)("Email Templates",u)}},null,8,["label","modelValue","onCreate"]),i(v,{doctype:"LMS Zoom Settings",label:e.__("Zoom Account"),modelValue:l.zoom_account,"onUpdate:modelValue":a[16]||(a[16]=t=>l.zoom_account=t),onCreate:(t,u)=>{o(V)("Zoom Accounts",u)}},null,8,["label","modelValue","onCreate"])]),s("div",je,[i(o(n),{modelValue:l.medium,"onUpdate:modelValue":a[17]||(a[17]=t=>l.medium=t),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),i(v,{doctype:"LMS Category",label:e.__("Category"),modelValue:l.category,"onUpdate:modelValue":a[18]||(a[18]=t=>l.category=t),onCreate:(t,u)=>o(V)("Categories",u)},null,8,["label","modelValue","onCreate"])]),s("div",Fe,[s("div",null,[s("div",Re,r(e.__("Meta Image")),1),l.image?(h(),B("div",Qe,[s("div",Je,[s("img",{src:l.image.file_url,class:"border rounded-md w-40"},null,8,We),s("div",Xe,[i(o(g),{onClick:a[20]||(a[20]=t=>J())},{default:_(()=>[y(r(e.__("Remove")),1)]),_:1}),s("div",Ye,r(e.__("Appears when the batch URL is shared on any online platform")),1)])])])):(h(),D(o(be),{key:0,fileTypes:["image/*"],validateFile:o(pe),onSuccess:a[19]||(a[19]=t=>Q(t))},{default:_(({file:t,progress:u,uploading:X,openFileSelector:U})=>[s("div",Ke,[s("div",{class:"border rounded-md w-fit py-5 px-5 md:px-20 cursor-pointer",onClick:U},[i(o(ce),{class:"size-5 stroke-1 text-ink-gray-7"})],8,Ze),s("div",He,[i(o(g),{onClick:U},{default:_(()=>[y(r(e.__("Upload")),1)]),_:1},8,["onClick"]),s("div",Ge,r(e.__("Appears when the batch URL is shared on socials")),1)])])]),_:1},8,["validateFile"]))])])])]),s("div",ea,[s("div",aa,r(e.__("Pricing")),1),i(o(n),{modelValue:l.paid_batch,"onUpdate:modelValue":a[21]||(a[21]=t=>l.paid_batch=t),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),l.paid_batch?(h(),B("div",ta,[i(o(n),{modelValue:l.amount,"onUpdate:modelValue":a[22]||(a[22]=t=>l.amount=t),label:e.__("Amount"),type:"number"},null,8,["modelValue","label"]),i(v,{doctype:"Currency",modelValue:l.currency,"onUpdate:modelValue":a[23]||(a[23]=t=>l.currency=t),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])):T("",!0)]),s("div",la,[s("div",sa,r(e.__("Meta Tags")),1),s("div",oa,[i(o(n),{modelValue:c.description,"onUpdate:modelValue":a[24]||(a[24]=t=>c.description=t),label:e.__("Meta Description"),type:"textarea",rows:7},null,8,["modelValue","label"]),i(o(n),{modelValue:c.keywords,"onUpdate:modelValue":a[25]||(a[25]=t=>c.keywords=t),label:e.__("Meta Keywords"),type:"textarea",rows:7,placeholder:e.__("Comma separated keywords for SEO")},null,8,["modelValue","label","placeholder"])])])])])}}};export{ra as default};
//# sourceMappingURL=BatchForm-GaJwVoVj.js.map
