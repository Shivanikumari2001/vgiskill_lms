import{a as _,o as c,e as a,l as C,t as i,f as u,w as V,u as n,p as x,x as I,y as B,z as K,i as G,c as P,ac as O,B as J,aa as L,J as W,E as H,b as p,h as k,bC as R,Q as m,bD as F,aK as U}from"./index-C4szjxrb.js";import{_ as Q}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-Bd-WFY5M.js";const X={class:"text-base border rounded-md w-1/3 mx-auto my-32"},Y={class:"border-b px-5 py-3 font-medium text-ink-gray-9"},Z={class:"px-5 py-3"},ee={class:"mb-4 leading-6 text-ink-gray-7"},N={__name:"NotPermitted",props:{title:{type:String,default:"Not Permitted"},text:{type:String,default:"You are not permitted to access this page."},buttonLabel:{type:String,default:"Login"},buttonLink:{type:String,default:"/login"}},setup(d){const h=d,w=()=>{window.location.href=h.buttonLink};return(y,r)=>(c(),_("div",X,[a("div",Y,[r[1]||(r[1]=a("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),C(" "+i(y.__(d.title)),1)]),a("div",Z,[a("div",ee,i(y.__(d.text)),1),u(n(x),{variant:"solid",class:"w-full",onClick:r[0]||(r[0]=g=>w())},{default:V(()=>[C(i(y.__(d.buttonLabel)),1)]),_:1})])]))}},te={class:""},se={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},ne={key:0,class:"pt-5 pb-10 mx-5"},ae={class:"flex flex-col lg:flex-row justify-between"},le={class:"flex flex-col lg:order-last mb-10 lg:mt-10 lg:w-1/4"},oe={class:"h-fit bg-surface-gray-2 rounded-md p-5 space-y-4"},ie={class:"space-y-1"},re={class:"text-ink-gray-5 uppercase text-xs"},ue={class:"leading-5 text-ink-gray-9"},de={key:0,class:"space-y-1"},ce={class:"text-ink-gray-5 uppercase text-xs"},me={class:"text-ink-gray-9"},pe={key:1,class:"space-y-1"},_e={class:"text-ink-gray-5"},ye={key:2,class:"space-y-1"},be={class:"text-ink-gray-5 uppercase text-xs"},ge={class:"text-ink-gray-9"},fe={class:"space-y-1 border-t border-outline-gray-3 pt-4 mt-2"},he={class:"uppercase text-ink-gray-5 text-xs"},ve={class:"font-bold text-ink-gray-9"},ke={class:"bg-surface-gray-2 rounded-md p-4 space-y-2 my-5"},Ve={class:"text-ink-gray-5 uppercase text-xs"},xe={class:"flex items-center space-x-2"},Ce={class:"bg-surface-amber-2 text-ink-amber-2 text-sm leading-5 p-2 rounded-md"},we={class:"flex-1 lg:mr-10"},Pe={class:"mb-5"},Le={class:"text-lg font-semibold text-ink-gray-9"},Se={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},$e={class:"space-y-4"},Be={class:"space-y-4"},Ue={class:"flex flex-col lg:flex-row items-start lg:items-center justify-between border-t pt-4 mt-8 space-y-4 lg:space-y-0"},Ne={key:0,class:"mt-1 text-xs text-ink-red-3"},Ae={key:1},Me={key:2},ze={__name:"Billing",props:{type:{type:String,required:!0},name:{type:String,required:!0}},setup(d){const h=G("$user"),{brand:w}=I(),y=B(!1);K(()=>{var s;const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",document.body.appendChild(e),(s=h.data)!=null&&s.name&&g.submit()});const r=d,g=P({url:"lms.lms.api.validate_billing_access",params:{billing_type:r.type,name:r.name},onSuccess(e){A(e.address),o.submit()}}),o=P({url:"lms.lms.utils.get_order_summary",makeParams(e){return{doctype:r.type=="batch"?"LMS Batch":"LMS Course",docname:r.name,country:t.country,coupon:b.value}},onError(e){D(e)}}),b=B(null),t=O({}),A=e=>{t.billing_name=(e==null?void 0:e.billing_name)||"",t.address_line1=(e==null?void 0:e.address_line1)||"",t.address_line2=(e==null?void 0:e.address_line2)||"",t.city=(e==null?void 0:e.city)||"",t.state=(e==null?void 0:e.state)||"",t.country=(e==null?void 0:e.country)||"",t.pincode=(e==null?void 0:e.pincode)||"",t.phone=(e==null?void 0:e.phone)||"",t.source=(e==null?void 0:e.source)||"",t.gstin=(e==null?void 0:e.gstin)||"",t.pan=(e==null?void 0:e.pan)||""},M=P({url:"lms.lms.payments.get_payment_link",makeParams(e){return{doctype:r.type=="batch"?"LMS Batch":"LMS Course",docname:r.name,title:o.data.title,amount:o.data.original_amount,discount_amount:o.data.discount_amount||0,gst_amount:o.data.gst_applied||0,currency:o.data.currency,address:t,redirect_to:E.value,payment_for_certificate:r.type=="certificate",coupon_code:b.value,coupon:o.data.coupon}}}),q=()=>{M.submit({},{validate(){return t.source?t.member_consent?z():(y.value=!0,__("Please provide your consent to proceed with the payment.")):__("Please let us know where you heard about us from.")},onSuccess(e){window.location.href=e},onError(e){var s;L.error(((s=e.messages)==null?void 0:s[0])||e)}})};function S(){if(!b.value){L.error(__("Please enter a coupon code"));return}o.reload()}function j(){b.value=null,o.reload()}const z=()=>{let e=["billing_name","address_line1","city","pincode","country","phone","source"];for(let f of e)if(!t[f])return"Please enter a valid "+f.replaceAll("_"," ").toLowerCase().replace(/\b\w/g,v=>v.toUpperCase());if(t.gstin&&!t.pan)return"Please enter a valid pan number.";if(t.country=="India"&&!t.state)return"Please enter a valid state with correct spelling and the first letter capitalized.";const s=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Delhi","Goa","Gujarat","Haryana","Himachal Pradesh","Jammu and Kashmir","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"];if(t.country=="India"&&!s.includes(t.state))return"Please enter a valid state with correct spelling and the first letter capitalized."},D=e=>{var s;L.error(((s=e.messages)==null?void 0:s[0])||e)},T=e=>{t.country=e,o.reload()},E=J(()=>{if(r.type=="course")return`/lms/courses/${r.name}`;if(r.type=="batch")return`/lms/batches/${r.name}`;if(r.type=="certificate")return`/lms/courses/${r.name}/certification`});return W(t,()=>{t.member_consent&&(y.value=!1)}),H(()=>({title:__("Billing Details"),icon:w.favicon})),(e,s)=>{var f,v,$;return c(),_("div",te,[a("header",se,[u(n(Q),{class:"h-7",items:[{label:e.__("Billing Details"),route:{name:"Billing"}}]},null,8,["items"])]),(f=n(g).data)!=null&&f.access&&n(o).data?(c(),_("div",ne,[a("div",ae,[a("div",le,[a("div",oe,[a("div",ie,[a("div",re,i(e.__("Payment for "))+" "+i(d.type)+": ",1),a("div",ue,i(n(o).data.title),1)]),n(o).data.gst_applied||n(o).data.discount_amount?(c(),_("div",de,[a("div",ce,i(e.__("Original Amount"))+": ",1),a("div",me,i(n(o).data.original_amount_formatted),1)])):p("",!0),n(o).data.discount_amount?(c(),_("div",pe,[a("div",_e,i(e.__("Discount"))+":",1),a("div",null,"- "+i(n(o).data.discount_amount_formatted),1)])):p("",!0),n(o).data.gst_applied?(c(),_("div",ye,[a("div",be,i(e.__("GST Amount"))+": ",1),a("div",ge,i(n(o).data.gst_amount_formatted),1)])):p("",!0),a("div",fe,[a("div",he,i(e.__("Total"))+": ",1),a("div",ve,i(n(o).data.total_amount_formatted),1)])]),a("div",ke,[a("span",Ve,i(e.__("Enter a Coupon Code"))+": ",1),a("div",xe,[u(n(m),{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=l=>b.value=l),disabled:n(o).data.discount_amount>0,onInput:s[1]||(s[1]=l=>b.value=l.target.value.toUpperCase()),onKeydown:R(S,["enter"]),placeholder:"COUPON2025",autocomplete:"off",class:"flex-1 [&_input]:bg-white"},null,8,["modelValue","disabled"]),n(o).data.discount_amount?p("",!0):(c(),k(n(x),{key:0,onClick:S,variant:"outline"},{default:V(()=>[C(i(e.__("Apply")),1)]),_:1})),n(o).data.discount_amount?(c(),k(n(x),{key:1,onClick:j,variant:"outline"},{icon:V(()=>[u(n(F),{class:"size-4 stroke-1.5"})]),_:1})):p("",!0)])]),a("p",Ce,i(e.__("Please ensure that the billing name you enter is correct, as it will be used on your invoice.")),1)]),a("div",we,[a("div",Pe,[a("div",Le,i(e.__("Address")),1)]),a("div",Se,[a("div",$e,[u(n(m),{label:e.__("Billing Name"),modelValue:t.billing_name,"onUpdate:modelValue":s[2]||(s[2]=l=>t.billing_name=l),required:!0},null,8,["label","modelValue"]),u(n(m),{label:e.__("Address Line 1"),modelValue:t.address_line1,"onUpdate:modelValue":s[3]||(s[3]=l=>t.address_line1=l),required:!0},null,8,["label","modelValue"]),u(n(m),{label:e.__("Address Line 2"),modelValue:t.address_line2,"onUpdate:modelValue":s[4]||(s[4]=l=>t.address_line2=l)},null,8,["label","modelValue"]),u(n(m),{label:e.__("City"),modelValue:t.city,"onUpdate:modelValue":s[5]||(s[5]=l=>t.city=l),required:!0},null,8,["label","modelValue"]),u(n(m),{label:e.__("State/Province"),modelValue:t.state,"onUpdate:modelValue":s[6]||(s[6]=l=>t.state=l)},null,8,["label","modelValue"])]),a("div",Be,[u(U,{doctype:"Country",value:t.country,onChange:s[7]||(s[7]=l=>T(l)),label:e.__("Country"),required:!0},null,8,["value","label"]),u(n(m),{label:e.__("Postal Code"),modelValue:t.pincode,"onUpdate:modelValue":s[8]||(s[8]=l=>t.pincode=l),required:!0},null,8,["label","modelValue"]),u(n(m),{label:e.__("Phone Number"),modelValue:t.phone,"onUpdate:modelValue":s[9]||(s[9]=l=>t.phone=l),required:!0},null,8,["label","modelValue"]),u(U,{doctype:"LMS Source",value:t.source,onChange:s[10]||(s[10]=l=>t.source=l),label:e.__("Where did you hear about us?"),required:!0},null,8,["value","label"]),t.country=="India"?(c(),k(n(m),{key:0,label:e.__("GST Number"),modelValue:t.gstin,"onUpdate:modelValue":s[11]||(s[11]=l=>t.gstin=l)},null,8,["label","modelValue"])):p("",!0),t.country=="India"?(c(),k(n(m),{key:1,label:e.__("PAN Number"),modelValue:t.pan,"onUpdate:modelValue":s[12]||(s[12]=l=>t.pan=l)},null,8,["label","modelValue"])):p("",!0)])]),a("div",Ue,[a("div",null,[u(n(m),{label:e.__("I consent to my personal information being stored for invoicing"),type:"checkbox",class:"leading-6",modelValue:t.member_consent,"onUpdate:modelValue":s[13]||(s[13]=l=>t.member_consent=l)},null,8,["label","modelValue"]),y.value?(c(),_("div",Ne,i(e.__("Please provide your consent to proceed with the payment")),1)):p("",!0)]),u(n(x),{variant:"solid",size:"md",onClick:s[14]||(s[14]=l=>q())},{default:V(()=>[C(i(e.__("Proceed to Payment")),1)]),_:1})])])])])):(v=n(g).data)!=null&&v.message?(c(),_("div",Ae,[u(N,{text:n(g).data.message,buttonLabel:d.type=="course"?"Checkout Course":"Checkout Batch",buttonLink:d.type=="course"?`/lms/courses/${d.name}`:`/lms/batches/${d.name}`},null,8,["text","buttonLabel","buttonLink"])])):($=n(h).data)!=null&&$.name?p("",!0):(c(),_("div",Me,[u(N,{text:"Please login to access this page.",buttonLink:`/login?redirect-to=/lms/billing/${d.type}/${d.name}`},null,8,["buttonLink"])]))])}}};export{ze as default};
//# sourceMappingURL=Billing-B0qQ6WJQ.js.map
